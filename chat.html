<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Teen Whisper - Tr√≤ chuy·ªán</title>
   
    <!-- 1. FONTS: Plus Jakarta Sans & Quicksand -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">

    <!-- 2. ICONS: Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- 3. STYLING: TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        display: ['"Quicksand"', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            blue: '#E0F2FE',  /* Sky 100 */
                            pink: '#FCE7F3',  /* Pink 100 */
                            purple: '#F3E8FF', /* Purple 100 */
                            primary: '#6366F1', /* Indigo 500 */
                            primaryHover: '#4F46E5',
                        }
                    },
                    animation: {
                        'blob': 'blob 10s infinite',
                        'bounce-slight': 'bounce-slight 0.5s ease-in-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        'bounce-slight': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- 4. CUSTOM CSS -->
    <style>
        body {
            background-color: #F8FAFC;
            height: 100vh;
            overflow: hidden; /* Prevent body scroll, handle inside chat container */
        }

        /* Glassmorphism Styles */
        .glass-header {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            border-top: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        /* Chat Bubbles */
        .bubble-user {
            background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
            color: white;
            border-radius: 18px 18px 4px 18px;
        }

        .bubble-bot {
            background: white;
            color: #334155;
            border-radius: 18px 18px 18px 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid #F1F5F9;
        }

        /* Typing Indicator Animation */
        .typing-dot {
            width: 6px;
            height: 6px;
            background-color: #94A3B8;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Hide Scrollbar but keep functionality */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Abstract Blobs Background */
        .blob-bg {
            position: absolute;
            filter: blur(60px);
            z-index: -1;
            opacity: 0.6;
            transition: all 1s ease;
        }

        /* Emergency Mode Styles */
        .emergency-mode .blob-bg {
            background-color: #FECACA !important; /* Red 200 */
        }
        .emergency-mode body {
            background-color: #FFF1F2;
        }
    </style>
</head>
<body class="text-slate-700 relative flex flex-col h-full">

    <!-- BACKGROUND BLOBS -->
    <div class="blob-bg bg-blue-200 w-80 h-80 rounded-full top-0 left-0 mix-blend-multiply animate-blob"></div>
    <div class="blob-bg bg-purple-200 w-80 h-80 rounded-full top-1/2 right-0 mix-blend-multiply animate-blob animation-delay-2000"></div>
    <div class="blob-bg bg-pink-200 w-80 h-80 rounded-full -bottom-10 left-20 mix-blend-multiply animate-blob animation-delay-4000"></div>

    <!-- 1. HEADER (C·ªë ƒë·ªãnh) -->
    <header class="glass-header z-50 h-16 flex items-center justify-between px-4 fixed top-0 w-full transition-all duration-300">
        <!-- Back & Avatar -->
        <div class="flex items-center gap-3">
            <button onclick="window.history.back()" class="p-2 rounded-full hover:bg-slate-100 transition-colors">
                <i data-lucide="chevron-left" class="w-6 h-6 text-slate-600"></i>
            </button>
            <div class="flex items-center gap-2">
                <div class="relative">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 border-2 border-white shadow-sm overflow-hidden flex items-center justify-center">
                        <!-- Mascot Avatar -->
                        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" alt="Bot Avatar" class="w-8 h-8 object-cover">
                    </div>
                    <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 border-2 border-white rounded-full"></span>
                </div>
                <div>
                    <h1 class="font-display font-bold text-slate-800 leading-tight">Teen Whisper</h1>
                    <p class="text-xs text-indigo-500 font-medium">Lu√¥n l·∫Øng nghe b·∫°n</p>
                </div>
            </div>
        </div>

        <!-- Right Actions: Panic Button & Menu -->
        <div class="flex items-center gap-2">
            <!-- Panic Button (Tho√°t nhanh) -->
            <button onclick="triggerQuickExit()" class="bg-red-50 hover:bg-red-100 text-red-600 px-3 py-1.5 rounded-full border border-red-200 flex items-center gap-1 transition-all shadow-sm active:scale-95">
                <i data-lucide="log-out" class="w-4 h-4"></i>
                <span class="text-xs font-bold hidden md:inline">Tho√°t nhanh</span>
            </button>
            
            <!-- More Options -->
            <div class="relative group">
                <button id="menuBtn" class="p-2 rounded-full hover:bg-slate-100 transition-colors">
                    <i data-lucide="more-vertical" class="w-5 h-5 text-slate-600"></i>
                </button>
                <!-- Dropdown Menu -->
                <div class="absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl border border-slate-100 hidden group-hover:block hover:block z-50 origin-top-right transition-all">
                    <button onclick="clearChat()" class="w-full text-left px-4 py-3 text-sm text-red-500 hover:bg-red-50 first:rounded-t-xl last:rounded-b-xl flex items-center gap-2">
                        <i data-lucide="trash-2" class="w-4 h-4"></i> X√≥a l·ªãch s·ª≠ chat
                    </button>
                    <button class="w-full text-left px-4 py-3 text-sm text-slate-600 hover:bg-slate-50 first:rounded-t-xl last:rounded-b-xl flex items-center gap-2">
                        <i data-lucide="image" class="w-4 h-4"></i> G·ª≠i ·∫£nh/Video
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 2. MAIN CHAT AREA -->
    <main id="chat-container" class="flex-grow pt-20 pb-40 px-4 overflow-y-auto no-scrollbar scroll-smooth">
        
        <!-- Welcome Message -->
        <div class="flex flex-col items-center justify-center my-6 space-y-2 opacity-80">
            <span class="text-xs font-semibold text-slate-400 bg-white/50 px-3 py-1 rounded-full">H√¥m nay, 16:03</span>
            <p class="text-xs text-slate-400 max-w-[250px] text-center">Tin nh·∫Øn ƒë∆∞·ª£c b·∫£o m·∫≠t v√† ·∫©n danh. Bot kh√¥ng thay th·∫ø b√°c sƒ©.</p>
        </div>

        <!-- Bot Message 1 -->
        <div class="flex items-end gap-2 mb-4 message-enter">
            <div class="w-8 h-8 rounded-full bg-indigo-100 flex-shrink-0 flex items-center justify-center border border-white shadow-sm overflow-hidden">
                <img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" alt="Bot" class="w-6 h-6">
            </div>
            <div class="bubble-bot px-4 py-3 max-w-[80%]">
                <p class="text-sm leading-relaxed">Ch√†o c·∫≠u! M√¨nh l√† Teen Whisper ƒë√¢y üëã. <br>H√¥m nay c·∫≠u c·∫£m th·∫•y th·∫ø n√†o? C√≥ chuy·ªán g√¨ khi·∫øn c·∫≠u bƒÉn khoƒÉn v·ªÅ tr∆∞·ªùng l·ªõp hay b·∫£n th√¢n kh√¥ng?</p>
            </div>
        </div>

        <!-- Placeholder for Dynamic Messages -->
        <div id="message-list"></div>

        <!-- Typing Indicator (Hidden by default) -->
        <div id="typing-indicator" class="flex items-end gap-2 mb-4 hidden">
            <div class="w-8 h-8 rounded-full bg-indigo-100 flex-shrink-0 flex items-center justify-center border border-white">
                <img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" alt="Bot" class="w-6 h-6">
            </div>
            <div class="bubble-bot px-4 py-3">
                <div class="flex gap-1">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        </div>

        <!-- Invisible div to scroll to -->
        <div id="bottom-anchor"></div>
    </main>

    <!-- 3. FOOTER (Input & Quick Replies) -->
    <footer class="fixed bottom-0 w-full z-40">
        
        <!-- Quick Replies (Horizontal Scroll) -->
        <div class="flex gap-2 px-4 pb-2 overflow-x-auto no-scrollbar mask-gradient" id="quick-replies">
            <button onclick="sendQuickReply('M√¨nh b·ªã √°p l·ª±c h·ªçc t·∫≠p qu√° üòû')" class="whitespace-nowrap bg-white/80 hover:bg-indigo-50 border border-indigo-100 text-indigo-600 text-xs font-semibold px-4 py-2 rounded-full shadow-sm transition-transform hover:scale-105 active:scale-95 backdrop-blur-sm">
                üìö √Åp l·ª±c thi c·ª≠
            </button>
            <button onclick="sendQuickReply('Crush kh√¥ng th√≠ch m√¨nh...')" class="whitespace-nowrap bg-white/80 hover:bg-pink-50 border border-pink-100 text-pink-600 text-xs font-semibold px-4 py-2 rounded-full shadow-sm transition-transform hover:scale-105 active:scale-95 backdrop-blur-sm">
                üíò Chuy·ªán Crush
            </button>
            <button onclick="sendQuickReply('T·∫°i sao m·∫∑t m√¨nh nhi·ªÅu m·ª•n th·∫ø?')" class="whitespace-nowrap bg-white/80 hover:bg-green-50 border border-green-100 text-green-600 text-xs font-semibold px-4 py-2 rounded-full shadow-sm transition-transform hover:scale-105 active:scale-95 backdrop-blur-sm">
                üåø M·ª•n d·∫≠y th√¨
            </button>
            <button onclick="sendQuickReply('Kinh nguy·ªát kh√¥ng ƒë·ªÅu')" class="whitespace-nowrap bg-white/80 hover:bg-purple-50 border border-purple-100 text-purple-600 text-xs font-semibold px-4 py-2 rounded-full shadow-sm transition-transform hover:scale-105 active:scale-95 backdrop-blur-sm">
                ü©∏ S·ª©c kh·ªèe sinh s·∫£n
            </button>
        </div>

        <!-- Input Area -->
        <div class="glass-input px-4 py-3 flex items-end gap-3 w-full">
            <!-- Add Media Button -->
            <button class="text-slate-400 hover:text-indigo-500 p-2 rounded-full hover:bg-slate-100 transition-colors">
                <i data-lucide="plus-circle" class="w-6 h-6"></i>
            </button>
            
            <!-- Text Input -->
            <div class="flex-grow relative">
                <textarea 
                    id="chat-input"
                    rows="1"
                    placeholder="Nh·∫≠p tin nh·∫Øn..." 
                    class="w-full bg-slate-100/80 border-0 rounded-2xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-300 focus:bg-white transition-all resize-none max-h-32 text-slate-700 placeholder-slate-400"
                    oninput="autoResize(this)"
                    onkeydown="checkEnter(event)"
                ></textarea>
            </div>

            <!-- Send Button -->
            <button onclick="sendMessage()" id="send-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-full shadow-lg shadow-indigo-200 transition-all hover:scale-110 active:scale-90 flex-shrink-0">
                <i data-lucide="send" class="w-5 h-5 ml-0.5"></i>
            </button>
        </div>
    </footer>

    <!-- 4. EMERGENCY OVERLAY (FR-04: C·∫£nh b√°o kh·∫©n c·∫•p) -->
    <div id="emergency-overlay" class="fixed inset-0 z-[100] bg-red-500/90 backdrop-blur-md hidden flex items-center justify-center p-6 opacity-0 transition-opacity duration-500">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl transform scale-95 transition-transform duration-300" id="emergency-card">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse-slow">
                <i data-lucide="life-buoy" class="w-10 h-10 text-red-600"></i>
            </div>
            <h2 class="text-2xl font-bold text-red-600 mb-2">B·∫°n kh√¥ng m·ªôt m√¨nh!</h2>
            <p class="text-slate-600 mb-6 text-sm">Ch√∫ng t√¥i nh·∫≠n th·∫•y b·∫°n ƒëang g·∫∑p kh√≥ khƒÉn l·ªõn v·ªÅ c·∫£m x√∫c. H√£y ƒë·ªÉ c√°c chuy√™n gia gi√∫p ƒë·ª° b·∫°n ngay l√∫c n√†y.</p>
            
            <a href="tel:111" class="block w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-red-200 transition-transform hover:scale-105 active:scale-95 mb-3 flex items-center justify-center gap-2">
                <i data-lucide="phone"></i> G·ªçi ngay 111
            </a>
            <button onclick="dismissEmergency()" class="text-slate-400 text-sm hover:text-slate-600 underline">T√¥i ƒë√£ ·ªïn, quay l·∫°i chat</button>
        </div>
    </div>

    <!-- SCRIPT Logic -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        // Init Icons
        lucide.createIcons();

        const chatInput = document.getElementById('chat-input');
        const messageList = document.getElementById('message-list');
        const bottomAnchor = document.getElementById('bottom-anchor');
        const typingIndicator = document.getElementById('typing-indicator');

        // FR-01: Auto Resize Textarea
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
            // Limit max height logic via CSS
        }

        // Check Enter Key
        function checkEnter(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        // FR-02: Send Message Logic
        function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            // 1. Add User Message
            appendMessage(text, 'user');
            chatInput.value = '';
            chatInput.style.height = 'auto'; // Reset height

            // FR-04: Emergency Detection (Mockup Logic)
            const dangerKeywords = ['ch·∫øt', 't·ª± t·ª≠', 'tr·∫ßm c·∫£m', 'c·ª©u', 'ƒëau kh·ªï qu√°', 'suicide', 'die'];
            const isEmergency = dangerKeywords.some(keyword => text.toLowerCase().includes(keyword));

            if (isEmergency) {
                setTimeout(() => showEmergencyOverlay(), 800);
                return; // Stop normal bot flow
            }

            // 2. Show Typing Indicator
            showTyping(true);

            // 3. Simulate AI Response (Delay 1.5s)
            setTimeout(() => {
                showTyping(false);
                const botResponse = generateMockResponse(text);
                appendMessage(botResponse, 'bot');
            }, 1500);
        }

        // Handle Quick Reply
        function sendQuickReply(text) {
            chatInput.value = text;
            sendMessage();
        }

        // Append Message to DOM
        function appendMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `flex ${sender === 'user' ? 'justify-end' : 'items-end gap-2'} mb-4 opacity-0 scale-95`;
            
            let htmlContent = '';

            if (sender === 'user') {
                htmlContent = `
                    <div class="bubble-user px-4 py-3 max-w-[80%] text-sm leading-relaxed shadow-md">
                        ${text}
                    </div>
                `;
            } else {
                htmlContent = `
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex-shrink-0 flex items-center justify-center border border-white shadow-sm overflow-hidden">
                        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" alt="Bot" class="w-6 h-6">
                    </div>
                    <div class="bubble-bot px-4 py-3 max-w-[80%] text-sm leading-relaxed">
                        ${text}
                    </div>
                `;
            }

            div.innerHTML = htmlContent;
            messageList.appendChild(div);

            // GSAP Animation for new message
            gsap.to(div, { opacity: 1, scale: 1, duration: 0.3, ease: "back.out(1.2)" });

            scrollToBottom();
        }

        // Toggle Typing Indicator
        function showTyping(show) {
            if (show) {
                typingIndicator.classList.remove('hidden');
                scrollToBottom();
            } else {
                typingIndicator.classList.add('hidden');
            }
        }

        // Scroll helper
        function scrollToBottom() {
            bottomAnchor.scrollIntoView({ behavior: 'smooth' });
        }

        // Quick Exit Logic
        function triggerQuickExit() {
            document.title = "Google";
            window.location.replace("https://www.google.com");
        }

        // FR-04: Emergency Logic
        function showEmergencyOverlay() {
            const overlay = document.getElementById('emergency-overlay');
            const card = document.getElementById('emergency-card');
            
            overlay.classList.remove('hidden');
            // GSAP fade in
            gsap.to(overlay, { opacity: 1, duration: 0.5 });
            gsap.to(card, { scale: 1, duration: 0.5, ease: "back.out(1.7)" });

            // Add styles to body to alert
            document.body.classList.add('emergency-mode');
        }

        function dismissEmergency() {
            const overlay = document.getElementById('emergency-overlay');
            gsap.to(overlay, { opacity: 0, duration: 0.3, onComplete: () => {
                overlay.classList.add('hidden');
            }});
            document.body.classList.remove('emergency-mode');
            
            // Bot resumes normally
            setTimeout(() => {
                appendMessage("M√¨nh hi·ªÉu l√† b·∫°n ƒëang r·∫•t r·ªëi b·ªùi. N·∫øu mu·ªën, ch√∫ng ta c√≥ th·ªÉ n√≥i v·ªÅ nh·ªØng s·ªü th√≠ch c·ªßa b·∫°n ƒë·ªÉ th∆∞ gi√£n h∆°n nh√©?", 'bot');
            }, 500);
        }

        // Clear Chat Logic
        function clearChat() {
            if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ chat ƒë·ªÉ b·∫£o m·∫≠t kh√¥ng?")) {
                messageList.innerHTML = '';
                // Restore welcome message logic if needed
                const notification = document.createElement('div');
                notification.className = 'text-center text-xs text-slate-400 my-4 italic';
                notification.innerText = 'ƒê√£ x√≥a l·ªãch s·ª≠ cu·ªôc tr√≤ chuy·ªán.';
                messageList.appendChild(notification);
            }
        }

        // Mock AI Logic (RAG Simulation)
        function generateMockResponse(input) {
            const lowerInput = input.toLowerCase();
            
            if (lowerInput.includes('m·ª•n')) {
                return "M·ª•n tr·ª©ng c√° l√† ƒëi·ªÅu r·∫•t b√¨nh th∆∞·ªùng ·ªü tu·ªïi d·∫≠y th√¨ do thay ƒë·ªïi hormone. C·∫≠u nh·ªõ r·ª≠a m·∫∑t s·∫°ch 2 l·∫ßn/ng√†y v√† h·∫°n ch·∫ø s·ªù tay l√™n m·∫∑t nh√©! C·∫≠u c√≥ mu·ªën m√¨nh g·ª£i √Ω ch·∫ø ƒë·ªô ƒÉn u·ªëng gi·∫£m m·ª•n kh√¥ng?";
            }
            if (lowerInput.includes('crush') || lowerInput.includes('th√≠ch')) {
                return "Wow, c·∫£m gi√°c 'rung rinh' ƒë·∫ßu ƒë·ªùi th√∫ v·ªã l·∫Øm nh·ªâ! ü•∞ Ng∆∞·ªùi ·∫•y c√≥ d·∫•u hi·ªáu g√¨ ƒë√°p l·∫°i c·∫≠u ch∆∞a? K·ªÉ m√¨nh nghe th√™m ƒëi!";
            }
            if (lowerInput.includes('h·ªçc') || lowerInput.includes('thi')) {
                return "√Åp l·ª±c thi c·ª≠ th·∫≠t s·ª± m·ªát m·ªèi. H√£y th·ª≠ ph∆∞∆°ng ph√°p Pomodoro (h·ªçc 25p, ngh·ªâ 5p) xem sao nh√©. C·∫≠u ƒëang lo l·∫Øng m√¥n n√†o nh·∫•t?";
            }
            if (lowerInput.includes('bu·ªìn') || lowerInput.includes('kh√≥c')) {
                return "M√¨nh ·ªü ƒë√¢y ƒë·ªÉ l·∫Øng nghe c·∫≠u. Kh√≥c m·ªôt ch√∫t c≈©ng kh√¥ng sao ƒë√¢u, ƒë√≥ l√† c√°ch c∆° th·ªÉ gi·∫£i t·ªèa m√†. C·∫≠u mu·ªën nghe m·ªôt b√†i nh·∫°c ch·ªØa l√†nh kh√¥ng?";
            }
            return "C·∫£m ∆°n c·∫≠u ƒë√£ chia s·∫ª. V·∫•n ƒë·ªÅ n√†y kh√° th√∫ v·ªã, m√¨nh c√≥ th·ªÉ t√¨m th√™m th√¥ng tin trong th∆∞ vi·ªán y khoa cho c·∫≠u nh√©. C·∫≠u mu·ªën bi·∫øt chi ti·∫øt h∆°n v·ªÅ kh√≠a c·∫°nh n√†o?";
        }

        // Initial Animation on Load
        window.addEventListener('load', () => {
            gsap.from("header", { y: -50, opacity: 0, duration: 0.8, ease: "power2.out" });
            gsap.from(".message-enter", { x: -20, opacity: 0, duration: 0.8, delay: 0.3, ease: "power2.out" });
            gsap.from("footer", { y: 50, opacity: 0, duration: 0.8, delay: 0.5, ease: "power2.out" });
        });

    </script>
</body>
</html>