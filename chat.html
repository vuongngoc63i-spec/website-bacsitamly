<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Teen Whisper - B·∫°n T√¢m Giao</title>
   
    <!-- 1. FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">

    <!-- 2. ICONS -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- 3. STYLING: TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        display: ['"Quicksand"', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            blue: '#E0F2FE', pink: '#FCE7F3', purple: '#F3E8FF',
                            primary: '#6366F1', primaryHover: '#4F46E5',
                        }
                    },
                    animation: {
                        'blob': 'blob 10s infinite',
                        'bounce-slight': 'bounce-slight 0.5s ease-in-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        'bounce-slight': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- 4. CUSTOM CSS -->
    <style>
        body { background-color: #F8FAFC; height: 100vh; overflow: hidden; }
        .glass-header { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        .glass-input { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(16px); border-top: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05); }
        .bubble-user { background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); color: white; border-radius: 18px 18px 4px 18px; }
        .bubble-bot { background: white; color: #334155; border-radius: 18px 18px 18px 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #F1F5F9; }
        .typing-dot { width: 6px; height: 6px; background-color: #94A3B8; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .blob-bg { position: absolute; filter: blur(60px); z-index: -1; opacity: 0.6; transition: all 1s ease; }
        .emergency-mode .blob-bg { background-color: #FECACA !important; }
        .emergency-mode body { background-color: #FFF1F2; }
    </style>
</head>
<body class="text-slate-700 relative flex flex-col h-full">

    <!-- BACKGROUND -->
    <div class="blob-bg bg-blue-200 w-80 h-80 rounded-full top-0 left-0 mix-blend-multiply animate-blob"></div>
    <div class="blob-bg bg-purple-200 w-80 h-80 rounded-full top-1/2 right-0 mix-blend-multiply animate-blob animation-delay-2000"></div>
    <div class="blob-bg bg-pink-200 w-80 h-80 rounded-full -bottom-10 left-20 mix-blend-multiply animate-blob animation-delay-4000"></div>

    <!-- HEADER -->
    <header class="glass-header z-50 h-16 flex items-center justify-between px-4 fixed top-0 w-full transition-all duration-300">
        <div class="flex items-center gap-3">
            <button onclick="window.history.back()" class="p-2 rounded-full hover:bg-slate-100"><i data-lucide="chevron-left" class="w-6 h-6 text-slate-600"></i></button>
            <div class="flex items-center gap-2">
                <div class="relative">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 border-2 border-white shadow-sm overflow-hidden flex items-center justify-center">
                        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" alt="Bot Avatar" class="w-8 h-8 object-cover">
                    </div>
                    <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 border-2 border-white rounded-full"></span>
                </div>
                <div>
                    <h1 class="font-display font-bold text-slate-800 leading-tight">Teen Whisper</h1>
                    <p class="text-xs text-indigo-500 font-medium">AI T∆∞ v·∫•n & B·∫ßu b·∫°n</p>
                </div>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <button onclick="triggerQuickExit()" class="bg-red-50 hover:bg-red-100 text-red-600 px-3 py-1.5 rounded-full border border-red-200 flex items-center gap-1 transition-all shadow-sm active:scale-95">
                <i data-lucide="log-out" class="w-4 h-4"></i>
                <span class="text-xs font-bold hidden md:inline">Tho√°t nhanh</span>
            </button>
            <div class="relative group">
                <button id="menuBtn" class="p-2 rounded-full hover:bg-slate-100"><i data-lucide="more-vertical" class="w-5 h-5 text-slate-600"></i></button>
                <div class="absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl border border-slate-100 hidden group-hover:block hover:block z-50">
                    <button onclick="clearChat()" class="w-full text-left px-4 py-3 text-sm text-red-500 hover:bg-red-50 first:rounded-t-xl last:rounded-b-xl flex items-center gap-2"><i data-lucide="trash-2" class="w-4 h-4"></i> X√≥a l·ªãch s·ª≠</button>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CHAT -->
    <main id="chat-container" class="flex-grow pt-20 pb-40 px-4 overflow-y-auto no-scrollbar scroll-smooth">
        <div class="flex flex-col items-center justify-center my-6 space-y-2 opacity-80">
            <span class="text-xs font-semibold text-slate-400 bg-white/50 px-3 py-1 rounded-full">H√¥m nay</span>
            <p class="text-xs text-slate-400 max-w-[250px] text-center">Tin nh·∫Øn ·∫©n danh. Bot kh√¥ng thay th·∫ø b√°c sƒ© chuy√™n khoa.</p>
        </div>
        <div class="flex items-end gap-2 mb-4 message-enter">
            <div class="w-8 h-8 rounded-full bg-indigo-100 flex-shrink-0 flex items-center justify-center border border-white shadow-sm overflow-hidden"><img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" class="w-6 h-6"></div>
            <div class="bubble-bot px-4 py-3 max-w-[80%]">
                <p class="text-sm leading-relaxed">Ch√†o c·∫≠u! üëã M√¨nh c√≥ th·ªÉ chia s·∫ª v·ªÅ m·ªçi th·ª© t·ª´ m·ª•n, chi·ªÅu cao, t√¨nh c·∫£m, cho ƒë·∫øn √°p l·ª±c h·ªçc t·∫≠p. C·∫≠u ƒëang nghƒ© g√¨ th·∫ø?</p>
            </div>
        </div>
        <div id="message-list"></div>
        <div id="typing-indicator" class="flex items-end gap-2 mb-4 hidden">
            <div class="w-8 h-8 rounded-full bg-indigo-100 flex-shrink-0 flex items-center justify-center border border-white"><img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" class="w-6 h-6"></div>
            <div class="bubble-bot px-4 py-3">
                <div class="flex gap-1"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>
            </div>
        </div>
        <div id="bottom-anchor"></div>
    </main>

    <!-- FOOTER -->
    <footer class="fixed bottom-0 w-full z-40">
        <div class="flex gap-2 px-4 pb-2 overflow-x-auto no-scrollbar mask-gradient" id="quick-replies">
            <button onclick="sendQuickReply('L√†m sao ƒë·ªÉ cao h∆°n?')" class="whitespace-nowrap bg-white/80 hover:bg-indigo-50 border border-indigo-100 text-indigo-600 text-xs font-semibold px-4 py-2 rounded-full shadow-sm transition-transform hover:scale-105 active:scale-95 backdrop-blur-sm">üìè TƒÉng chi·ªÅu cao</button>
            <button onclick="sendQuickReply('Crush kh√¥ng th√≠ch m√¨nh...')" class="whitespace-nowrap bg-white/80 hover:bg-pink-50 border border-pink-100 text-pink-600 text-xs font-semibold px-4 py-2 rounded-full shadow-sm transition-transform hover:scale-105 active:scale-95 backdrop-blur-sm">üíò Chuy·ªán Crush</button>
            <button onclick="sendQuickReply('M·ª•n nhi·ªÅu qu√° ph·∫£i l√†m sao?')" class="whitespace-nowrap bg-white/80 hover:bg-green-50 border border-green-100 text-green-600 text-xs font-semibold px-4 py-2 rounded-full shadow-sm transition-transform hover:scale-105 active:scale-95 backdrop-blur-sm">üåø Tr·ªã m·ª•n</button>
            <button onclick="sendQuickReply('M√¨nh b·ªã b·∫Øt n·∫°t ·ªü tr∆∞·ªùng')" class="whitespace-nowrap bg-white/80 hover:bg-red-50 border border-red-100 text-red-600 text-xs font-semibold px-4 py-2 rounded-full shadow-sm transition-transform hover:scale-105 active:scale-95 backdrop-blur-sm">üõë B·∫Øt n·∫°t</button>
        </div>
        <div class="glass-input px-4 py-3 flex items-end gap-3 w-full">
            <div class="flex-grow relative">
                <textarea id="chat-input" rows="1" placeholder="Nh·∫≠p tin nh·∫Øn..." class="w-full bg-slate-100/80 border-0 rounded-2xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-300 focus:bg-white transition-all resize-none max-h-32 text-slate-700 placeholder-slate-400" oninput="autoResize(this)" onkeydown="checkEnter(event)"></textarea>
            </div>
            <button onclick="sendMessage()" id="send-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-full shadow-lg shadow-indigo-200 transition-all hover:scale-110 active:scale-90 flex-shrink-0"><i data-lucide="send" class="w-5 h-5 ml-0.5"></i></button>
        </div>
    </footer>

    <!-- EMERGENCY OVERLAY -->
    <div id="emergency-overlay" class="fixed inset-0 z-[100] bg-red-500/90 backdrop-blur-md hidden flex items-center justify-center p-6 opacity-0 transition-opacity duration-500">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl transform scale-95 transition-transform duration-300" id="emergency-card">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse-slow"><i data-lucide="life-buoy" class="w-10 h-10 text-red-600"></i></div>
            <h2 class="text-2xl font-bold text-red-600 mb-2">B·∫°n kh√¥ng m·ªôt m√¨nh!</h2>
            <p class="text-slate-600 mb-6 text-sm">C√≥ v·∫ª b·∫°n ƒëang g·∫∑p kh√≥ khƒÉn l·ªõn v·ªÅ c·∫£m x√∫c. H√£y li√™n h·ªá chuy√™n gia ngay nh√©.</p>
            <a href="tel:111" class="block w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-red-200 transition-transform hover:scale-105 active:scale-95 mb-3 flex items-center justify-center gap-2"><i data-lucide="phone"></i> G·ªçi T·ªïng ƒë√†i 111</a>
            <button onclick="dismissEmergency()" class="text-slate-400 text-sm hover:text-slate-600 underline">T√¥i ·ªïn, quay l·∫°i chat</button>
        </div>
    </div>

    <!-- SCRIPT Logic -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        lucide.createIcons();
        const chatInput = document.getElementById('chat-input');
        const messageList = document.getElementById('message-list');
        const bottomAnchor = document.getElementById('bottom-anchor');
        const typingIndicator = document.getElementById('typing-indicator');

        // ============================================
        // 1. KNOWLEDGE BASE (D·ªÆ LI·ªÜU C·ª¶A BOT)
        // ============================================
        const botBrain = [
            // S·ª©c kh·ªèe th·ªÉ ch·∫•t
            {
                keywords: ['m·ª•n', 'tr·ª©ng c√°', 'da m·∫∑t', 'nh·ªùn', 'r·ª≠a m·∫∑t'],
                response: "M·ª•n l√† 'b·∫°n ƒë·ªìng h√†nh' b·∫•t ƒë·∫Øc dƒ© c·ªßa d·∫≠y th√¨ do hormone thay ƒë·ªïi. B√≠ k√≠p l√†: R·ª≠a m·∫∑t s√°ng/t·ªëi, h·∫°n ch·∫ø s·ªù tay l√™n m·∫∑t, u·ªëng nhi·ªÅu n∆∞·ªõc v√† ng·ªß s·ªõm. N·∫øu m·ª•n vi√™m n·∫∑ng, h√£y r·ªß b·ªë m·∫π ƒëi kh√°m da li·ªÖu nh√©! üåø"
            },
            {
                keywords: ['chi·ªÅu cao', 'cao', 'l√πn', 'ng·∫Øn', 'ph√°t tri·ªÉn'],
                response: "Giai ƒëo·∫°n n√†y l√† 'c∆° h·ªôi v√†ng' ƒë·ªÉ cao l√™n ƒë·∫•y! H√£y ng·ªß tr∆∞·ªõc 10h t·ªëi (hormone tƒÉng tr∆∞·ªüng ti·∫øt ra l√∫c ng·ªß), u·ªëng s·ªØa/b·ªï sung canxi v√† ch∆°i c√°c m√¥n k√©o gi√£n nh∆∞ b∆°i l·ªôi, b√≥ng r·ªï, x√† ƒë∆°n. C·ªë l√™n! üèÄ"
            },
            {
                keywords: ['m√πi', 'h√¥i n√°ch', 'c∆° th·ªÉ', 'm·ªì h√¥i', 'n√°ch'],
                response: "ƒê·ª´ng lo, tuy·∫øn m·ªì h√¥i ho·∫°t ƒë·ªông m·∫°nh l√† d·∫•u hi·ªáu c·∫≠u ƒëang l·ªõn. H√£y t·∫Øm r·ª≠a s·∫°ch s·∫Ω h√†ng ng√†y v√† th·ª≠ d√πng lƒÉn kh·ª≠ m√πi xem sao. Ch·ªçn lo·∫°i d·ªãu nh·∫π th√¥i nh√©! üöø"
            },
            {
                keywords: ['kinh nguy·ªát', 'ƒë√®n ƒë·ªè', 'bƒÉng v·ªá sinh', 'ƒëau b·ª•ng', 't·ªõi th√°ng'],
                response: "Kinh nguy·ªát l√† d·∫•u hi·ªáu c·∫≠u ƒë√£ tr·ªü th√†nh thi·∫øu n·ªØ. N·∫øu ƒëau b·ª•ng, h√£y ch∆∞·ªùm ·∫•m v√† u·ªëng n∆∞·ªõc ·∫•m. Chu k·ª≥ c√≥ th·ªÉ ch∆∞a ƒë·ªÅu trong 1-2 nƒÉm ƒë·∫ßu, nh∆∞ng n·∫øu qu√° ƒëau ho·∫∑c ra qu√° nhi·ªÅu th√¨ n√™n ƒëi kh√°m nh√©. ü©∏"
            },
            {
                keywords: ['v·ª° gi·ªçng', 'gi·ªçng n√≥i', '·ªìm', 'kh√†n'],
                response: "V·ª° gi·ªçng l√† do d√¢y thanh qu·∫£n c·ªßa c·∫≠u ƒëang d√†i v√† d√†y l√™n (ƒë·∫∑c bi·ªát l√† c√°c b·∫°n nam). ƒê·ª´ng ng·∫°i ng√πng, ai r·ªìi c≈©ng qua giai ƒëo·∫°n 'v·ªãt ƒë·ª±c' n√†y th√¥i. H·∫°n ch·∫ø h√©t to ƒë·ªÉ b·∫£o v·ªá h·ªçng nh√©! üé§"
            },
            {
                keywords: ['m·ªông tinh', 'gi·∫•c m∆° ∆∞·ªõt', 'qu·∫ßn l√≥t ∆∞·ªõt', 'ng·ªß d·∫≠y'],
                response: "M·ªông tinh (xu·∫•t tinh khi ng·ªß) l√† c∆° ch·∫ø t·ª± nhi√™n ƒë·ªÉ c∆° th·ªÉ gi·∫£i ph√≥ng tinh d·ªãch d∆∞ th·ª´a. N√≥ ho√†n to√†n b√¨nh th∆∞·ªùng v√† cho th·∫•y c·∫≠u m√°y m√≥c ƒëang ho·∫°t ƒë·ªông t·ªët. Ch·ªâ c·∫ßn v·ªá sinh s·∫°ch s·∫Ω l√† ƒë∆∞·ª£c. üõèÔ∏è"
            },
            {
                keywords: ['ng·ª±c', 'v√≤ng 1', '√°o l√≥t', 'ƒëau ng·ª±c'],
                response: "Ng·ª±c ph√°t tri·ªÉn c√≥ th·ªÉ g√¢y ng·ª©a ho·∫∑c ƒëau nh·∫π, ƒë√≥ l√† b√¨nh th∆∞·ªùng. H√£y ch·ªçn √°o l√≥t (bra) v·ª´a v·∫∑n, ch·∫•t li·ªáu cotton tho√°ng m√°t ƒë·ªÉ b·∫£o v·ªá v√≤ng 1 nh√©. üëô"
            },
            {
                keywords: ['l√¥ng', 'r√¢u', 'v√πng k√≠n'],
                response: "L√¥ng m·ªçc ·ªü n√°ch, ch√¢n, hay v√πng k√≠n l√† ƒë·ªÉ b·∫£o v·ªá c∆° th·ªÉ th√¥i. N·∫øu th·∫•y phi·ªÅn, c·∫≠u c√≥ th·ªÉ t·ªâa g·ªçn, nh∆∞ng c·∫©n th·∫≠n khi d√πng dao c·∫°o nh√©, d·ªÖ vi√™m l·ªó ch√¢n l√¥ng l·∫Øm ƒë·∫•y."
            },

            // S·ª©c kh·ªèe tinh th·∫ßn & T√¨nh c·∫£m
            {
                keywords: ['crush', 'th√≠ch', 't·ªè t√¨nh', 'y√™u'],
                response: "C·∫£m n·∫Øng ai ƒë√≥ l√† c·∫£m x√∫c tuy·ªát v·ªùi nh·∫•t tu·ªïi n√†y! ü•∞ C·ª© t·ª± nhi√™n l√†m b·∫°n, quan t√¢m nh·∫π nh√†ng xem ng∆∞·ªùi ta ph·∫£n ·ª©ng sao. D√π k·∫øt qu·∫£ th·∫ø n√†o th√¨ ƒë√¢y c≈©ng l√† k·ª∑ ni·ªám ƒë·∫πp."
            },
            {
                keywords: ['bu·ªìn', 'kh√≥c', 'tr·∫ßm c·∫£m', 'ch√°n', 'c√¥ ƒë∆°n'],
                response: "C√≥ nh·ªØng ng√†y th·∫≠t t·ªá ƒë√∫ng kh√¥ng? Kh√≥c m·ªôt ch√∫t c≈©ng ƒë∆∞·ª£c, ƒë√≥ l√† c√°ch x·∫£ stress. C·∫≠u c√≥ mu·ªën nghe nh·∫°c hay ƒëi d·∫°o kh√¥ng? N·∫øu c·∫£m gi√°c n√†y k√©o d√†i qu√° 2 tu·∫ßn, h√£y n√≥i v·ªõi ng∆∞·ªùi l·ªõn tin c·∫≠y nh√©."
            },
            {
                keywords: ['h·ªçc', 'thi', 'ƒëi·ªÉm k√©m', '√°p l·ª±c', 'b√†i t·∫≠p'],
                response: "√Åp l·ª±c h·ªçc t·∫≠p ƒë√¥i khi l√†m m√¨nh ng·ªôp th·ªü. Th·ª≠ ph∆∞∆°ng ph√°p Pomodoro (h·ªçc 25p, ngh·ªâ 5p) xem sao? ƒê·ª´ng so s√°nh m√¨nh v·ªõi 'con nh√† ng∆∞·ªùi ta', c·∫≠u ƒë√£ c·ªë g·∫Øng h·∫øt s·ª©c r·ªìi m√†! üìö"
            },
            {
                keywords: ['b·ªë m·∫π', 'gia ƒë√¨nh', 'c√£i nhau', 'm·∫Øng', 'kh√¥ng hi·ªÉu'],
                response: "Kho·∫£ng c√°ch th·∫ø h·ªá l√†m b·ªë m·∫π v√† c·∫≠u kh√≥ hi·ªÉu nhau. L√∫c b√¨nh tƒ©nh, h√£y th·ª≠ vi·∫øt th∆∞ ho·∫∑c nh·∫Øn tin n√≥i r√µ c·∫£m x√∫c c·ªßa c·∫≠u xem. ƒê·ª´ng c√£i tay ƒë√¥i l√∫c ƒëang n√≥ng gi·∫≠n nh√©. üè†"
            },
            {
                keywords: ['b·∫°n b√®', 'ngh·ªâ ch∆°i', 'x√≠ch m√≠ch', 'c√£i l·ªôn'],
                response: "T√¨nh b·∫°n tu·ªïi n√†y 's√°ng n·∫Øng chi·ªÅu m∆∞a' l√† th∆∞·ªùng t√¨nh. N·∫øu l√† b·∫°n th√¢n, h√£y th·∫≥ng th·∫Øn ng·ªìi l·∫°i n√≥i chuy·ªán. C√≤n n·∫øu h·ªç toxic (ƒë·ªôc h·∫°i), bu√¥ng b·ªè c≈©ng l√† c√°ch y√™u b·∫£n th√¢n."
            },
            {
                keywords: ['b·∫Øt n·∫°t', 't·∫©y chay', 'ƒë√°nh', 's·ª£'],
                response: "B·∫Øt n·∫°t kh√¥ng bao gi·ªù l√† l·ªói c·ªßa c·∫≠u! H√£y t√¨m s·ª± gi√∫p ƒë·ª° t·ª´ th·∫ßy c√¥, gia ƒë√¨nh ho·∫∑c g·ªçi t·ªïng ƒë√†i 111. ƒê·ª´ng im l·∫∑ng ch·ªãu ƒë·ª±ng, c·∫≠u x·ª©ng ƒë√°ng ƒë∆∞·ª£c t√¥n tr·ªçng. üõë"
            },
            {
                keywords: ['game', 'ƒëi·ªán tho·∫°i', 'nghi·ªán', 'internet'],
                response: "Th·∫ø gi·ªõi ·∫£o r·∫•t cu·ªën, nh∆∞ng ƒë·ª´ng ƒë·ªÉ n√≥ nu·ªët ch·ª≠ng th·∫ø gi·ªõi th·∫≠t. Th·ª≠ ƒë·∫∑t gi·ªõi h·∫°n d√πng m√°y 1-2 ti·∫øng/ng√†y v√† ra ngo√†i v·∫≠n ƒë·ªông xem, c·∫≠u s·∫Ω th·∫•y ƒë·∫ßu √≥c nh·∫π nh√µm h∆°n nhi·ªÅu. üéÆ"
            },
            {
                keywords: ['lgbt', 'gay', 'les', 'b√™ ƒë√™', 'gi·ªõi t√≠nh'],
                response: "Vi·ªác kh√°m ph√° xu h∆∞·ªõng t√≠nh d·ª•c l√† m·ªôt h√†nh tr√¨nh d√†i. D√π c·∫≠u l√† ai, c·∫≠u v·∫´n x·ª©ng ƒë√°ng ƒë∆∞·ª£c y√™u th∆∞∆°ng v√† t√¥n tr·ªçng. H√£y c·ª© l√† ch√≠nh m√¨nh nh√©! üè≥Ô∏è‚Äçüåà"
            }
        ];

        // C√°c c√¢u tr·∫£ l·ªùi ng·∫´u nhi√™n khi KH√îNG t√¨m th·∫•y t·ª´ kh√≥a (Fallback)
        const fallbackResponses = [
            "Ch·ªß ƒë·ªÅ n√†y th√∫ v·ªã ƒë·∫•y, c·∫≠u k·ªÉ chi ti·∫øt h∆°n ƒë∆∞·ª£c kh√¥ng? ü§î",
            "M√¨nh ƒëang l·∫Øng nghe ƒë√¢y, c·∫≠u n√≥i ti·∫øp ƒëi...",
            "C√¢u n√†y h∆°i kh√≥ v·ªõi m√¨nh, nh∆∞ng m√¨nh lu√¥n ·ªü ƒë√¢y ƒë·ªÉ chia s·∫ª c√πng c·∫≠u.",
            "Nghe c√≥ v·∫ª c·∫≠u ƒëang trƒÉn tr·ªü nhi·ªÅu l·∫Øm. C·∫£m gi√°c ƒë√≥ th·∫ø n√†o?",
            "M√¨nh ch∆∞a hi·ªÉu r√µ √Ω c·∫≠u l·∫Øm, √Ω c·∫≠u l√† v·ªÅ chuy·ªán h·ªçc h√†nh hay t√¨nh c·∫£m?",
            "C·ª© tho·∫£i m√°i t√¢m s·ª± nh√©, ·ªü ƒë√¢y ch·ªâ c√≥ t·ª•i m√¨nh th√¥i."
        ];

        // C√°c c√¢u ch√†o h·ªèi x√£ giao
        const socialResponses = {
            greetings: ['hi', 'ch√†o', 'hello', 'alo', '√™'],
            thanks: ['c·∫£m ∆°n', 'thank', 'thanks', 'iu bot'],
            bye: ['t·∫°m bi·ªát', 'bye', 'ng·ªß ngon']
        };

        // ============================================
        // 2. LOGIC X·ª¨ L√ù (THE BRAIN)
        // ============================================

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        function checkEnter(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            appendMessage(text, 'user');
            chatInput.value = '';
            chatInput.style.height = 'auto';

            // Ki·ªÉm tra kh·∫©n c·∫•p
            const dangerKeywords = ['ch·∫øt', 't·ª± t·ª≠', 'suicide', 'die', 'kh√¥ng mu·ªën s·ªëng', 'ƒëau kh·ªï qu√°'];
            if (dangerKeywords.some(k => text.toLowerCase().includes(k))) {
                setTimeout(() => showEmergencyOverlay(), 800);
                return;
            }

            showTyping(true);

            // X·ª≠ l√Ω ph·∫£n h·ªìi sau 1s
            setTimeout(() => {
                showTyping(false);
                const botResponse = generateSmartResponse(text);
                appendMessage(botResponse, 'bot');
            }, 1000 + Math.random() * 1000); // Random delay cho t·ª± nhi√™n
        }

        function sendQuickReply(text) {
            chatInput.value = text;
            sendMessage();
        }

        function appendMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `flex ${sender === 'user' ? 'justify-end' : 'items-end gap-2'} mb-4 opacity-0 scale-95`;
            
            let htmlContent = '';
            if (sender === 'user') {
                htmlContent = `<div class="bubble-user px-4 py-3 max-w-[80%] text-sm leading-relaxed shadow-md">${text}</div>`;
            } else {
                htmlContent = `
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex-shrink-0 flex items-center justify-center border border-white shadow-sm overflow-hidden">
                        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" alt="Bot" class="w-6 h-6">
                    </div>
                    <div class="bubble-bot px-4 py-3 max-w-[80%] text-sm leading-relaxed">${text}</div>
                `;
            }

            div.innerHTML = htmlContent;
            messageList.appendChild(div);
            gsap.to(div, { opacity: 1, scale: 1, duration: 0.3, ease: "back.out(1.2)" });
            scrollToBottom();
        }

        function showTyping(show) {
            if (show) {
                typingIndicator.classList.remove('hidden');
                scrollToBottom();
            } else {
                typingIndicator.classList.add('hidden');
            }
        }

        function scrollToBottom() {
            bottomAnchor.scrollIntoView({ behavior: 'smooth' });
        }

        // === H√ÄM TR√ç TU·ªÜ NH√ÇN T·∫†O GI·∫¢ L·∫¨P ===
        function generateSmartResponse(input) {
            const lowerInput = input.toLowerCase();

            // 1. Ki·ªÉm tra ch√†o h·ªèi x√£ giao
            if (socialResponses.greetings.some(w => lowerInput.includes(w))) 
                return "Ch√†o c·∫≠u! H√¥m nay c·∫≠u th·∫ø n√†o? C√≥ chuy·ªán g√¨ vui (ho·∫∑c bu·ªìn) k·ªÉ m√¨nh nghe ƒëi! ‚úåÔ∏è";
            
            if (socialResponses.thanks.some(w => lowerInput.includes(w))) 
                return "Kh√¥ng c√≥ chi! Gi√∫p ƒë∆∞·ª£c c·∫≠u l√† m√¨nh vui r·ªìi. ü•∞";

            if (socialResponses.bye.some(w => lowerInput.includes(w))) 
                return "T·∫°m bi·ªát nha! Nh·ªõ gi·ªØ g√¨n s·ª©c kh·ªèe ƒë√≥. üëã";

            // 2. Qu√©t Keywords trong Knowledge Base
            // S·∫Øp x·∫øp botBrain ƒë·ªÉ ∆∞u ti√™n c√°c ch·ªß ƒë·ªÅ kh·ªõp nhi·ªÅu t·ª´ kh√≥a h∆°n (n·∫øu c·∫ßn)
            for (let topic of botBrain) {
                // Ki·ªÉm tra n·∫øu input ch·ª©a b·∫•t k·ª≥ keyword n√†o c·ªßa topic
                if (topic.keywords.some(key => lowerInput.includes(key))) {
                    return topic.response;
                }
            }

            // 3. Fallback (N·∫øu kh√¥ng t√¨m th·∫•y g√¨)
            const randomFallback = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
            return randomFallback;
        }

        function triggerQuickExit() {
            document.title = "Google";
            window.location.replace("https://www.google.com");
        }

        function showEmergencyOverlay() {
            const overlay = document.getElementById('emergency-overlay');
            const card = document.getElementById('emergency-card');
            overlay.classList.remove('hidden');
            gsap.to(overlay, { opacity: 1, duration: 0.5 });
            gsap.to(card, { scale: 1, duration: 0.5, ease: "back.out(1.7)" });
            document.body.classList.add('emergency-mode');
        }

        function dismissEmergency() {
            const overlay = document.getElementById('emergency-overlay');
            gsap.to(overlay, { opacity: 0, duration: 0.3, onComplete: () => {
                overlay.classList.add('hidden');
            }});
            document.body.classList.remove('emergency-mode');
            setTimeout(() => {
                appendMessage("M√¨nh r·∫•t lo l·∫Øng cho c·∫≠u. Ch√∫ng m√¨nh n√≥i v·ªÅ chuy·ªán g√¨ nh·∫π nh√†ng h∆°n nh√©?", 'bot');
            }, 500);
        }

        function clearChat() {
            if(confirm("X√≥a l·ªãch s·ª≠ chat?")) {
                messageList.innerHTML = '';
            }
        }

        window.addEventListener('load', () => {
            gsap.from("header", { y: -50, opacity: 0, duration: 0.8 });
            gsap.from(".message-enter", { x: -20, opacity: 0, duration: 0.8, delay: 0.3 });
            gsap.from("footer", { y: 50, opacity: 0, duration: 0.8, delay: 0.5 });
        });
    </script>
</body>
</html>