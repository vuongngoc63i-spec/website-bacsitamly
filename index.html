<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Teen Whisper - ƒêa Chi·ªÅu</title>
   
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">

    <!-- ICONS & TAILWIND -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'], display: ['"Quicksand"', 'sans-serif'] },
                    animation: { 'blob': 'blob 10s infinite', 'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite' },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #F8FAFC; height: 100vh; overflow: hidden; }
        .glass-panel { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.5); }
        .bubble-user { background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); color: white; border-radius: 18px 18px 4px 18px; }
        .bubble-bot { background: white; color: #334155; border-radius: 18px 18px 18px 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #F1F5F9; }
        .typing-dot { width: 6px; height: 6px; bg-slate-400; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; background-color: #94A3B8; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .blob-bg { position: absolute; filter: blur(60px); z-index: -1; opacity: 0.6; }
        
        /* Hi·ªáu ·ª©ng chuy·ªÉn c·∫£nh */
        .hidden-screen { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-slate-700 relative flex flex-col h-full">

    <!-- BACKGROUND BLOBS -->
    <div class="blob-bg bg-blue-200 w-96 h-96 rounded-full top-0 left-0 mix-blend-multiply animate-blob"></div>
    <div class="blob-bg bg-purple-200 w-96 h-96 rounded-full bottom-0 right-0 mix-blend-multiply animate-blob animation-delay-2000"></div>

    <!-- ============================================ -->
    <!-- M√ÄN H√åNH 1: L·ª∞A CH·ªåN VAI TR√í (LANDING PAGE) -->
    <!-- ============================================ -->
    <section id="role-selection-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center p-6 bg-white/30 backdrop-blur-sm">
        <div class="glass-panel p-8 rounded-3xl shadow-2xl max-w-md w-full text-center transform transition-all hover:scale-[1.01]">
            <div class="w-20 h-20 bg-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg shadow-indigo-200">
                <i data-lucide="message-circle-heart" class="w-10 h-10 text-white"></i>
            </div>
            <h1 class="text-3xl font-display font-bold text-slate-800 mb-2">Teen Whisper</h1>
            <p class="text-slate-500 mb-8">B·∫°n mu·ªën tr√≤ chuy·ªán v·ªõi ai h√¥m nay?</p>
            
            <div class="space-y-3">
                <button onclick="selectRole('friend')" class="w-full flex items-center p-4 rounded-xl border border-indigo-100 bg-white hover:bg-indigo-50 hover:border-indigo-300 transition-all group text-left shadow-sm">
                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-4 text-2xl group-hover:scale-110 transition-transform">üòé</div>
                    <div>
                        <h3 class="font-bold text-slate-700">Ng∆∞·ªùi B·∫°n Th√¢n</h3>
                        <p class="text-xs text-slate-400">T√¢m s·ª± tho·∫£i m√°i, ng√¥n ng·ªØ Gen Z</p>
                    </div>
                </button>

                <button onclick="selectRole('parent')" class="w-full flex items-center p-4 rounded-xl border border-orange-100 bg-white hover:bg-orange-50 hover:border-orange-300 transition-all group text-left shadow-sm">
                    <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center mr-4 text-2xl group-hover:scale-110 transition-transform">üè°</div>
                    <div>
                        <h3 class="font-bold text-slate-700">B·ªë M·∫π T√¢m L√Ω</h3>
                        <p class="text-xs text-slate-400">Quan t√¢m, ·∫•m √°p, l·ªùi khuy√™n gia ƒë√¨nh</p>
                    </div>
                </button>

                <button onclick="selectRole('expert')" class="w-full flex items-center p-4 rounded-xl border border-teal-100 bg-white hover:bg-teal-50 hover:border-teal-300 transition-all group text-left shadow-sm">
                    <div class="w-10 h-10 rounded-full bg-teal-100 flex items-center justify-center mr-4 text-2xl group-hover:scale-110 transition-transform">üë©‚Äç‚öïÔ∏è</div>
                    <div>
                        <h3 class="font-bold text-slate-700">Chuy√™n Gia T√¢m L√Ω</h3>
                        <p class="text-xs text-slate-400">Kh√°ch quan, khoa h·ªçc, gi·∫£i ph√°p c·ª• th·ªÉ</p>
                    </div>
                </button>
            </div>
        </div>
        <p class="mt-6 text-xs text-slate-400">D·ªØ li·ªáu ƒë∆∞·ª£c b·∫£o m·∫≠t v√† ·∫©n danh 100%</p>
    </section>

    <!-- ============================================ -->
    <!-- M√ÄN H√åNH 2: GIAO DI·ªÜN CHAT (·∫®n l√∫c ƒë·∫ßu) -->
    <!-- ============================================ -->
    <div id="chat-interface" class="flex flex-col h-full hidden-screen opacity-0">
        
        <!-- HEADER -->
        <header class="glass-panel h-16 flex items-center justify-between px-4 fixed top-0 w-full z-40 shadow-sm">
            <div class="flex items-center gap-3">
                <button onclick="location.reload()" class="p-2 rounded-full hover:bg-slate-100"><i data-lucide="chevron-left" class="w-6 h-6 text-slate-600"></i></button>
                <div class="flex items-center gap-2">
                    <div class="relative">
                        <div class="w-10 h-10 rounded-full bg-indigo-50 border-2 border-white shadow-sm overflow-hidden flex items-center justify-center text-xl" id="bot-avatar">
                            ü§ñ
                        </div>
                        <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 border-2 border-white rounded-full"></span>
                    </div>
                    <div>
                        <h1 class="font-display font-bold text-slate-800 leading-tight" id="bot-name">Teen Whisper</h1>
                        <p class="text-xs text-indigo-500 font-medium" id="bot-role-text">ƒêang ho·∫°t ƒë·ªông</p>
                    </div>
                </div>
            </div>
            <button onclick="clearChat()" class="p-2 text-slate-400 hover:text-red-500"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
        </header>

        <!-- MAIN CONTENT -->
        <main id="chat-container" class="flex-grow pt-20 pb-40 px-4 overflow-y-auto no-scrollbar scroll-smooth">
            <div id="message-list"></div>
            <!-- Typing Indicator -->
            <div id="typing-indicator" class="flex items-end gap-2 mb-4 hidden">
                <div class="w-8 h-8 rounded-full bg-slate-100 flex-shrink-0 flex items-center justify-center border border-white text-sm" id="typing-avatar">ü§ñ</div>
                <div class="bubble-bot px-4 py-3">
                    <div class="flex gap-1"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>
                </div>
            </div>
            <div id="bottom-anchor"></div>
        </main>

        <!-- FOOTER -->
        <footer class="fixed bottom-0 w-full z-40 bg-white/80 backdrop-blur-md pb-4 pt-2">
            <div class="glass-input px-4 flex items-end gap-3 w-full max-w-3xl mx-auto">
                <div class="flex-grow relative">
                    <textarea id="chat-input" rows="1" placeholder="Nh·∫≠p tin nh·∫Øn..." class="w-full bg-slate-100 border-0 rounded-2xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-300 focus:bg-white transition-all resize-none max-h-32 text-slate-700 placeholder-slate-400" oninput="autoResize(this)" onkeydown="checkEnter(event)"></textarea>
                </div>
                <button onclick="sendMessage()" class="bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-full shadow-lg shadow-indigo-200 transition-all hover:scale-110 active:scale-90 flex-shrink-0"><i data-lucide="send" class="w-5 h-5 ml-0.5"></i></button>
            </div>
        </footer>
    </div>

    <!-- SCRIPT Logic -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        lucide.createIcons();

        // DOM Elements
        const roleScreen = document.getElementById('role-selection-screen');
        const chatInterface = document.getElementById('chat-interface');
        const messageList = document.getElementById('message-list');
        const chatInput = document.getElementById('chat-input');
        const bottomAnchor = document.getElementById('bottom-anchor');
        const typingIndicator = document.getElementById('typing-indicator');

        // State
        let currentRole = 'friend'; // Default

        // ============================================
        // 1. DATA: B·ªò N√ÉO ƒêA NH√ÇN C√ÅCH (15+ CH·ª¶ ƒê·ªÄ)
        // ============================================
        const botBrain = [
            {
                keywords: ['m·ª•n', 'tr·ª©ng c√°', 'da m·∫∑t'],
                responses: {
                    friend: "√îi m·ª•n ch√°n ha? üò© Tui c≈©ng hay b·ªã n√®. Nh·ªõ ƒë·ª´ng c√≥ s·ªù tay l√™n n·∫∑n nha, s·∫πo r·ªó l√† ti√™u lu√¥n √°. R·ª≠a m·∫∑t k·ªπ v√†o!",
                    parent: "Con ƒë·ª´ng lo, tu·ªïi d·∫≠y th√¨ ai c≈©ng v·∫≠y m√†. ƒê·ªÉ m·∫π mua cho con lo·∫°i s·ªØa r·ª≠a m·∫∑t d·ªãu nh·∫π nh√©. Con nh·ªõ ng·ªß s·ªõm, th·ª©c khuya h·∫°i da l·∫Øm ƒë·∫•y.",
                    expert: "M·ª•n tr·ª©ng c√° l√† do s·ª± tƒÉng ti·∫øt b√£ nh·ªùn v√† vi khu·∫©n P.acnes. Em c·∫ßn duy tr√¨ quy tr√¨nh l√†m s·∫°ch da 2 b∆∞·ªõc, v√† h·∫°n ch·∫ø ƒë∆∞·ªùng/s·ªØa trong kh·∫©u ph·∫ßn ƒÉn nh√©."
                }
            },
            {
                keywords: ['chi·ªÅu cao', 'cao', 'l√πn'],
                responses: {
                    friend: "Mu·ªën cao th√¨ ƒëi b∆°i v·ªõi tui ƒë√™! üèä‚Äç‚ôÇÔ∏è V·ªõi c·∫£ u·ªëng s·ªØa thay n∆∞·ªõc l·ªçc lu√¥n kkk. C·ªë l√™n bro!",
                    parent: "B·ªë m·∫π ƒëang c·ªë g·∫Øng n·∫•u nhi·ªÅu m√≥n canxi cho con ƒë√¢y. Con ch·ªãu kh√≥ ƒÉn u·ªëng v·ªõi ƒëi ng·ªß tr∆∞·ªõc 10 gi·ªù t·ªëi nh√©, l√∫c ƒë√≥ hormone m·ªõi ho·∫°t ƒë·ªông t·ªët.",
                    expert: "Giai ƒëo·∫°n n√†y l√† ƒë·ªânh tƒÉng tr∆∞·ªüng. Em c·∫ßn k·∫øt h·ª£p 3 y·∫øu t·ªë: Dinh d∆∞·ª°ng (Canxi, Vit D3), V·∫≠n ƒë·ªông (b∆°i, b√≥ng r·ªï) v√† Gi·∫•c ng·ªß (ng·ªß s√¢u t·ª´ 22h-2h s√°ng)."
                }
            },
            {
                keywords: ['crush', 'th√≠ch', 't·ªè t√¨nh', 'y√™u'],
                responses: {
                    friend: "U·∫ßy u·∫ßy, ai th·∫ø? üòç K·ªÉ nghe coi! M√† c·ª© t·ª´ t·ª´ th√¥i nha, coi ch·ª´ng ng∆∞·ªùi ta 'th·∫£ th√≠nh' ƒë√≥.",
                    parent: "C√≥ t√¨nh c·∫£m v·ªõi b·∫°n kh√°c gi·ªõi l√† b√¨nh th∆∞·ªùng th√¥i con. B·ªë m·∫π kh√¥ng c·∫•m, nh∆∞ng con nh·ªõ gi·ªØ ch·ª´ng m·ª±c v√† ƒë·ª´ng ƒë·ªÉ ·∫£nh h∆∞·ªüng vi·ªác h·ªçc nh√©.",
                    expert: "Rung ƒë·ªông ƒë·∫ßu ƒë·ªùi l√† c·∫£m x√∫c t√¢m l√Ω t·ª± nhi√™n. Em h√£y coi ƒë√≥ l√† ƒë·ªông l·ª±c ƒë·ªÉ c√πng nhau ti·∫øn b·ªô, ƒë·ª´ng ƒë·ªÉ c·∫£m x√∫c chi ph·ªëi qu√° nhi·ªÅu ƒë·∫øn cu·ªôc s·ªëng h√†ng ng√†y."
                }
            },
            {
                keywords: ['bu·ªìn', 'kh√≥c', 'ch√°n', 'stress'],
                responses: {
                    friend: "Sao d·ª£? Ai l√†m g√¨ c·∫≠u √†? ƒêi l√†m v√°n game hay tr√† s·ªØa kh√¥ng cho ƒë·ª° bu·ªìn? Tui nghe n√®. ü•∫",
                    parent: "C√≥ chuy·ªán g√¨ n√≥i b·ªë m·∫π nghe ƒë∆∞·ª£c kh√¥ng? V·ªÅ nh√† l√† ƒë·ªÉ ƒë∆∞·ª£c y√™u th∆∞∆°ng m√†, ƒë·ª´ng gi·ªØ trong l√≤ng m·ªôt m√¨nh con nh√©.",
                    expert: "T√¥i hi·ªÉu em ƒëang tr·∫£i qua giai ƒëo·∫°n kh√≥ khƒÉn. C·∫£m x√∫c ti√™u c·ª±c l√† m·ªôt t√≠n hi·ªáu. Em h√£y th·ª≠ h√≠t th·ªü s√¢u ho·∫∑c vi·∫øt nh·∫≠t k√Ω ƒë·ªÉ gi·∫£i t·ªèa xem sao."
                }
            },
            {
                keywords: ['h·ªçc', 'thi', 'ƒëi·ªÉm k√©m', 'b√†i t·∫≠p'],
                responses: {
                    friend: "H·ªçc h√†nh √°p l·ª±c x·ªâu lu√¥n √°. Th√¥i r√°ng thi xong r·ªìi x√µa. Hay l√† h·ªçc nh√≥m ƒëi cho vui?",
                    parent: "ƒêi·ªÉm s·ªë kh√¥ng ph·∫£i l√† t·∫•t c·∫£ ƒë√¢u con. B·ªë m·∫π ch·ªâ c·∫ßn con ƒë√£ c·ªë g·∫Øng h·∫øt s·ª©c l√† ƒë∆∞·ª£c. ƒê·ª´ng t·ª± t·∫°o √°p l·ª±c qu√° nh√©.",
                    expert: "ƒê·ªÉ h·ªçc hi·ªáu qu·∫£, em kh√¥ng n√™n h·ªçc nh·ªìi nh√©t. H√£y √°p d·ª•ng ph∆∞∆°ng ph√°p Pomodoro: h·ªçc 25 ph√∫t, ngh·ªâ 5 ph√∫t ƒë·ªÉ n√£o b·ªô ƒë∆∞·ª£c h·ªìi ph·ª•c."
                }
            },
            {
                keywords: ['m√πi', 'h√¥i n√°ch', 'c∆° th·ªÉ'],
                responses: {
                    friend: "Haha chuy·ªán nh·ªè, tui c≈©ng x√†i lƒÉn kh·ª≠ m√πi m√†. Mua chai n√†o th∆°m th∆°m x√≠u l√† t·ª± tin ngay!",
                    parent: "Con l·ªõn r·ªìi n√™n tuy·∫øn m·ªì h√¥i ho·∫°t ƒë·ªông m·∫°nh h∆°n th√¥i. Con nh·ªõ t·∫Øm r·ª≠a k·ªπ v√† thay qu·∫ßn √°o m·ªói ng√†y l√† ƒë∆∞·ª£c.",
                    expert: "M√πi c∆° th·ªÉ do vi khu·∫©n ph√¢n h·ªßy m·ªì h√¥i g√¢y ra. Em n√™n ch·ªçn s·∫£n ph·∫©m kh·ª≠ m√πi c√≥ ch·ª©a mu·ªëi nh√¥m v√† m·∫∑c qu·∫ßn √°o cotton tho√°ng kh√≠."
                }
            },
            {
                keywords: ['kinh nguy·ªát', 'ƒë√®n ƒë·ªè', 'ƒëau b·ª•ng'],
                responses: {
                    friend: "Th∆∞∆°ng gh√™, ƒëau l·∫Øm kh√¥ng? üò≠ L·∫•y t√∫i ch∆∞·ªùm ·∫•m ƒëi, v·ªõi u·ªëng n∆∞·ªõc ·∫•m nha. ƒê·ª´ng u·ªëng n∆∞·ªõc ƒë√° nhen!",
                    parent: "Con g√°i m·∫π l·ªõn r·ªìi. N·∫øu ƒëau qu√° th√¨ b·∫£o m·∫π, m·∫π pha n∆∞·ªõc g·ª´ng cho. Nh·ªõ thay bƒÉng th∆∞·ªùng xuy√™n ƒë·ªÉ gi·ªØ v·ªá sinh con nh√©.",
                    expert: "Chu k·ª≥ kinh nguy·ªát tu·ªïi n√†y th∆∞·ªùng ch∆∞a ƒë·ªÅu do r·ªëi lo·∫°n n·ªôi ti·∫øt t·ªë. N·∫øu em ƒëau b·ª•ng d·ªØ d·ªôi ho·∫∑c l∆∞·ª£ng m√°u qu√° nhi·ªÅu, ch√∫ng ta c·∫ßn ƒëi si√™u √¢m ki·ªÉm tra."
                }
            },
            {
                keywords: ['v·ª° gi·ªçng', '·ªìm', 'kh√†n'],
                responses: {
                    friend: "Gi·ªçng ·ªìm ·ªìm nghe ng·∫ßu m√†! üòÇ ƒê·ª´ng lo, th·∫±ng n√†o l·ªõp m√¨nh ch·∫£ b·ªã. S·∫Øp th√†nh 'so√°i ca' r·ªìi ƒë√≥.",
                    parent: "ƒê√¢y l√† d·∫•u hi·ªáu con ƒë√£ tr·ªü th√†nh ch√†ng trai th·ª±c th·ª• r·ªìi. Con h·∫°n ch·∫ø la h√©t ƒë·ªÉ b·∫£o v·ªá d√¢y thanh qu·∫£n nh√©.",
                    expert: "Hi·ªán t∆∞·ª£ng v·ª° gi·ªçng l√† do d√¢y thanh qu·∫£n d√†y l√™n d∆∞·ªõi t√°c ƒë·ªông c·ªßa Testosterone. N√≥ s·∫Ω ·ªïn ƒë·ªãnh sau kho·∫£ng 6 th√°ng ƒë·∫øn 1 nƒÉm."
                }
            },
            {
                keywords: ['b·ªë m·∫π', 'c√£i nhau', 'gia ƒë√¨nh'],
                responses: {
                    friend: "Ng∆∞·ªùi l·ªõn kh√≥ hi·ªÉu l·∫Øm. Th√¥i k·ªá ƒëi, ƒë·ª£i ·ªïng b·∫£ ngu√¥i gi·∫≠n r·ªìi m√¨nh l·ª±a l·ªùi n√≥i sau. C·∫≠u c√≤n c√≥ tui m√†.",
                    parent: "B·ªë m·∫π ƒë√¥i khi n√≥ng gi·∫≠n v√¨ lo cho con th√¥i. L√∫c n√†o b√¨nh tƒ©nh, con th·ª≠ ng·ªìi l·∫°i n√≥i chuy·ªán nh·∫π nh√†ng v·ªõi b·ªë m·∫π xem sao?",
                    expert: "M√¢u thu·∫´n th·∫ø h·ªá l√† ƒëi·ªÅu kh√≥ tr√°nh kh·ªèi. Em h√£y th·ª≠ s·ª≠ d·ª•ng c·∫•u tr√∫c c√¢u 'Con c·∫£m th·∫•y... khi b·ªë m·∫π...' ƒë·ªÉ b√†y t·ªè c·∫£m x√∫c m√† kh√¥ng g√¢y chi·∫øn."
                }
            },
            {
                keywords: ['b·∫Øt n·∫°t', 't·∫©y chay', 'ƒë√°nh'],
                responses: {
                    friend: "C√°i g√¨? ƒê·ª©a n√†o d√°m ƒë·ª•ng v√†o c·∫≠u? üò° ƒê·ª´ng im l·∫∑ng, ph·∫£i b√°o th·∫ßy c√¥ ngay. Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ t·ª•i n√≥ l·∫•n l∆∞·ªõt!",
                    parent: "Ai l√†m ƒëau con? N√≥i b·ªë m·∫π nghe ngay! B·ªë m·∫π s·∫Ω b·∫£o v·ªá con, kh√¥ng ai c√≥ quy·ªÅn l√†m t·ªïn th∆∞∆°ng con c·∫£.",
                    expert: "H√†nh vi b·∫Øt n·∫°t l√† kh√¥ng th·ªÉ ch·∫•p nh·∫≠n. Em c·∫ßn t√¨m ki·∫øm s·ª± tr·ª£ gi√∫p t·ª´ ng∆∞·ªùi l·ªõn ƒë√°ng tin c·∫≠y ngay l·∫≠p t·ª©c. ƒê·ª´ng ƒë·ªëi m·∫∑t m·ªôt m√¨nh."
                }
            },
            {
                keywords: ['game', 'nghi·ªán', 'internet'],
                responses: {
                    friend: "Game cu·ªën thi·ªát nh∆∞ng ch∆°i √≠t th√¥i kh√¥ng m·∫Øt c·∫≠n l√≤i ra ƒë·∫•y bro. R·ªß tui ƒëi ƒë√° banh ƒë√™!",
                    parent: "B·ªë m·∫π kh√¥ng c·∫•m ch∆°i, nh∆∞ng con ph·∫£i bi·∫øt c√¢n ƒë·ªëi gi·ªù gi·∫•c. Ch∆°i xong nh·ªõ l√†m b√†i t·∫≠p v√† ph·ª• gi√∫p vi·ªác nh√† nh√©.",
                    expert: "Nghi·ªán game c√≥ th·ªÉ l√†m gi·∫£m kh·∫£ nƒÉng t·∫≠p trung. Em n√™n ƒë·∫∑t quy t·∫Øc: ch·ªâ ch∆°i game sau khi ho√†n th√†nh m·ªçi tr√°ch nhi·ªám trong ng√†y."
                }
            },
            {
                keywords: ['lgbt', 'gay', 'les', 'gi·ªõi t√≠nh'],
                responses: {
                    friend: "D√π c·∫≠u l√† ai th√¨ tui v·∫´n l√† b·∫°n c·∫≠u m√†! üè≥Ô∏è‚Äçüåà C·ª© l√† ch√≠nh m√¨nh th√¥i, ai n√≥i g√¨ k·ªá h·ªç.",
                    parent: "Con l√† con c·ªßa b·ªë m·∫π, ƒëi·ªÅu ƒë√≥ kh√¥ng bao gi·ªù thay ƒë·ªïi. B·ªë m·∫π lu√¥n y√™u th∆∞∆°ng con v√¥ ƒëi·ªÅu ki·ªán.",
                    expert: "Xu h∆∞·ªõng t√≠nh d·ª•c l√† m·ªôt ph·ªï ƒëa d·∫°ng. Vi·ªác em kh√°m ph√° b·∫£n th√¢n l√† h√†nh tr√¨nh d≈©ng c·∫£m. H√£y t√¥n tr·ªçng c·∫£m x√∫c th·∫≠t c·ªßa m√¨nh."
                }
            }
        ];

        // Fallback responses (Khi kh√¥ng hi·ªÉu)
        const fallbacks = {
            friend: ["C√°i n√†y m·ªõi √† nha, k·ªÉ r√µ h∆°n ƒëi!", "Tui ch∆∞a hi·ªÉu l·∫Øm, n√≥i l·∫°i coi bro?", "Nghe cƒÉng th·∫≥ng d·ª£, r·ªìi sao n·ªØa?"],
            parent: ["B·ªë m·∫π ch∆∞a hi·ªÉu √Ω con l·∫Øm, con n√≥i r√µ h∆°n ƒë∆∞·ª£c kh√¥ng?", "Chuy·ªán n√†y c√≥ v·∫ª quan tr·ªçng, con k·ªÉ ti·∫øp ƒëi.", "B·ªë m·∫π lu√¥n l·∫Øng nghe con ƒë√¢y."],
            expert: ["V·∫•n ƒë·ªÅ n√†y c·∫ßn th√™m th√¥ng tin. Em c√≥ th·ªÉ chia s·∫ª c·ª• th·ªÉ h∆°n kh√¥ng?", "T√¥i ƒëang l·∫Øng nghe, em c·ª© ti·∫øp t·ª•c.", "ƒê√¢y l√† m·ªôt ch·ªß ƒë·ªÅ ph·ª©c t·∫°p, em k·ªÉ chi ti·∫øt h∆°n nh√©."]
        };

        // ============================================
        // 2. LOGIC CH·ª®C NƒÇNG
        // ============================================

        // Ch·ªçn vai tr√≤ v√† chuy·ªÉn m√†n h√¨nh
        function selectRole(role) {
            currentRole = role;
            
            // UI Updates
            const avatars = { friend: 'üòé', parent: 'üè°', expert: 'üë©‚Äç‚öïÔ∏è' };
            const names = { friend: 'B·∫°n Th√¢n', parent: 'B·ªë M·∫π', expert: 'Chuy√™n Gia T√¢m L√Ω' };
            const roles = { friend: 'Lu√¥n b√™n b·∫°n', parent: 'Gia ƒë√¨nh l√† s·ªë 1', expert: 'T∆∞ v·∫•n chuy√™n s√¢u' };
            
            document.getElementById('bot-avatar').innerText = avatars[role];
            document.getElementById('typing-avatar').innerText = avatars[role];
            document.getElementById('bot-name').innerText = names[role];
            document.getElementById('bot-role-text').innerText = roles[role];

            // Animation Transition
            gsap.to(roleScreen, { opacity: 0, duration: 0.5, onComplete: () => {
                roleScreen.classList.add('hidden-screen');
                chatInterface.classList.remove('hidden-screen');
                chatInterface.classList.add('fade-in');
                
                // G·ª≠i l·ªùi ch√†o ƒë·∫ßu ti√™n
                setTimeout(() => {
                    let greeting = "";
                    if(role === 'friend') greeting = "H·∫ø l√¥! H√¥m nay c√≥ bi·∫øn g√¨ kh√¥ng k·ªÉ tui nghe coi? üòé";
                    else if(role === 'parent') greeting = "Ch√†o con y√™u! H√¥m nay ƒëi h·ªçc c√≥ vui kh√¥ng? V·ªÅ nh√† c√≥ chuy·ªán g√¨ k·ªÉ b·ªë m·∫π nghe n√†o. üè°";
                    else greeting = "Ch√†o em. T√¥i l√† chuy√™n gia t√¢m l√Ω. Em ƒëang g·∫∑p kh√∫c m·∫Øc g√¨ c·∫ßn gi·∫£i t·ªèa kh√¥ng? üë©‚Äç‚öïÔ∏è";
                    
                    appendMessage(greeting, 'bot');
                }, 500);
            }});
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        function checkEnter(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            appendMessage(text, 'user');
            chatInput.value = '';
            chatInput.style.height = 'auto';

            // Show typing
            typingIndicator.classList.remove('hidden');
            bottomAnchor.scrollIntoView({ behavior: 'smooth' });

            // Generate Response
            setTimeout(() => {
                typingIndicator.classList.add('hidden');
                const response = getResponse(text);
                appendMessage(response, 'bot');
            }, 1200);
        }

        function getResponse(input) {
            const lowerInput = input.toLowerCase();
            
            // 1. T√¨m trong Knowledge Base
            for (let topic of botBrain) {
                if (topic.keywords.some(k => lowerInput.includes(k))) {
                    return topic.responses[currentRole]; // Tr·∫£ v·ªÅ c√¢u tr·∫£ l·ªùi theo vai tr√≤
                }
            }
            
            // 2. Fallback
            const fallbackList = fallbacks[currentRole];
            return fallbackList[Math.floor(Math.random() * fallbackList.length)];
        }

        function appendMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `flex ${sender === 'user' ? 'justify-end' : 'items-end gap-2'} mb-4 opacity-0 scale-95`;
            
            const avatar = document.getElementById('bot-avatar').innerText;

            if (sender === 'user') {
                div.innerHTML = `<div class="bubble-user px-4 py-3 max-w-[80%] text-sm leading-relaxed shadow-md">${text}</div>`;
            } else {
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-slate-100 flex-shrink-0 flex items-center justify-center border border-white shadow-sm overflow-hidden text-sm">
                        ${avatar}
                    </div>
                    <div class="bubble-bot px-4 py-3 max-w-[80%] text-sm leading-relaxed">${text}</div>
                `;
            }

            messageList.appendChild(div);
            gsap.to(div, { opacity: 1, scale: 1, duration: 0.3 });
            bottomAnchor.scrollIntoView({ behavior: 'smooth' });
        }

        function clearChat() {
            if(confirm("X√≥a tin nh·∫Øn v√† quay l·∫°i ch·ªçn vai tr√≤?")) {
                location.reload();
            }
        }
    </script>
</body>
</html>