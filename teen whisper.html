<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Teen Whisper - H·ªá Sinh Th√°i To√†n Di·ªán</title>
    
    <!-- FONTS & ICONS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'], display: ['"Quicksand"', 'sans-serif'] },
                    colors: {
                        brand: { blue: '#E0F2FE', pink: '#FCE7F3', purple: '#F3E8FF', primary: '#6366F1', text: '#334155' }
                    },
                    animation: { 'float': 'float 6s ease-in-out infinite', 'blob': 'blob 10s infinite' }
                }
            }
        }
    </script>

    <style>
        body { background-color: #F8FAFC; overflow-x: hidden; height: 100vh; margin: 0; }
        .glass-panel { background: rgba(255, 255, 255, 0.75); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); }
        .blob-bg { position: absolute; filter: blur(60px); z-index: -1; opacity: 0.6; }
        .bubble-user { background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); color: white; border-radius: 18px 18px 4px 18px; }
        .bubble-bot { background: white; color: #334155; border-radius: 18px 18px 18px 4px; border: 1px solid #F1F5F9; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .typing-dot { width: 6px; height: 6px; background-color: #94A3B8; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .hidden-screen { display: none !important; }
        .chat-footer-elevated { padding-bottom: calc(2rem + env(safe-area-inset-bottom)); }
        .danger-overlay { background: rgba(220, 38, 38, 0.98); backdrop-filter: blur(10px); z-index: 1000; }
    </style>
</head>
<body class="text-brand-text relative h-full">

    <div class="blob-bg bg-blue-200 w-96 h-96 rounded-full top-0 left-0 animate-blob"></div>
    <div class="blob-bg bg-purple-200 w-96 h-96 rounded-full bottom-0 right-0 animate-blob animation-delay-2000"></div>

    <!-- ============================================ -->
    <!-- M√ÄN H√åNH 1: TRANG CH·ª¶ -->
    <!-- ============================================ -->
    <div id="landing-page" class="flex flex-col h-full w-full relative z-10">
        <header class="w-full p-4 flex justify-between items-center z-50 fixed top-0 bg-white/30 backdrop-blur-md border-b border-white/20">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold shadow-lg">T</div>
                <span class="font-display font-bold text-lg text-indigo-900">TeenWhisper</span>
            </div>
            <button onclick="triggerQuickExit()" class="bg-red-50 text-red-600 px-4 py-2 rounded-full border border-red-200 text-sm font-semibold shadow-sm">Tho√°t nhanh Google</button>
        </header>

        <main class="flex-grow flex items-center justify-center pt-24 pb-12 px-4">
            <div class="container max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                <div class="order-2 md:order-1 text-center md:text-left space-y-6">
                    <h1 class="font-display text-4xl md:text-6xl font-bold text-slate-800 leading-tight">Ch√†o b·∫°n, m√¨nh l√† <span class="text-indigo-600">Teen Whisper</span></h1>
                    <p class="text-lg text-slate-600">L·∫Øng nghe m·ªçi t√¢m t∆∞ c·ªßa c·∫≠u. ·∫®n danh. B·∫£o m·∫≠t. Kh√¥ng ph√°n x√©t.</p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                        <button onclick="showScreen('#multi-dim-chat')" class="bg-indigo-600 text-white px-8 py-4 rounded-2xl shadow-xl hover:scale-105 active:scale-95 flex items-center gap-3 font-semibold text-lg">
                            <i data-lucide="message-circle-heart"></i><span>B·∫Øt ƒë·∫ßu tr√≤ chuy·ªán</span>
                        </button>
                        <button onclick="showScreen('#library-page')" class="bg-white text-indigo-900 border border-indigo-100 px-8 py-4 rounded-2xl shadow-sm flex items-center gap-3 font-semibold text-lg transition-all">
                            <i data-lucide="book-open"></i><span>Kh√°m ph√° th∆∞ vi·ªán</span>
                        </button>
                    </div>
                </div>
                <div class="order-1 md:order-2 flex justify-center mascot-col">
                    <div class="animate-float w-64 h-64 md:w-96 md:h-96 rounded-full bg-gradient-to-tr from-indigo-200 to-pink-200 flex items-center justify-center shadow-2xl glass-panel relative">
                        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" class="w-[75%] h-[75%] object-contain">
                        <div class="absolute -top-4 -right-4 bg-white px-4 py-2 rounded-xl shadow-lg text-indigo-600 font-bold animate-bounce text-sm">üëã Ch√†o c·∫≠u!</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ============================================ -->
    <!-- M√ÄN H√åNH 2: CHAT ƒêA CHI·ªÄU -->
    <!-- ============================================ -->
    <div id="multi-dim-chat" class="hidden-screen fixed inset-0 z-[60] flex flex-col h-full bg-[#F8FAFC]">
        <!-- Role Selection -->
        <div id="role-selection-screen" class="absolute inset-0 z-50 flex flex-col items-center justify-center p-6 bg-white/40 backdrop-blur-md">
            <div class="glass-panel p-8 rounded-3xl shadow-2xl max-w-md w-full text-center">
                <h1 class="text-2xl font-display font-bold text-slate-800 mb-6">B·∫°n mu·ªën t√¢m s·ª± v·ªõi ai?</h1>
                <div class="space-y-3 mb-6">
                    <button onclick="selectRole('friend')" class="w-full flex items-center p-4 rounded-xl border bg-white hover:bg-indigo-50 transition-all text-left shadow-sm">
                        <div class="text-2xl mr-4">üòé</div>
                        <div><h3 class="font-bold text-sm text-slate-700">Ng∆∞·ªùi B·∫°n Th√¢n</h3><p class="text-[11px] text-slate-400">Ng√¥n ng·ªØ Gen Z, x·∫£ stress c·ª±c m·∫°nh</p></div>
                    </button>
                    <button onclick="selectRole('parent')" class="w-full flex items-center p-4 rounded-xl border bg-white hover:bg-orange-50 transition-all text-left shadow-sm">
                        <div class="text-2xl mr-4">üè°</div>
                        <div><h3 class="font-bold text-sm text-slate-700">B·ªë M·∫π T√¢m L√Ω</h3><p class="text-[11px] text-slate-400">·∫§m √°p, th·∫•u hi·ªÉu, y√™u th∆∞∆°ng</p></div>
                    </button>
                    <button onclick="selectRole('expert')" class="w-full flex items-center p-4 rounded-xl border bg-white hover:bg-teal-50 transition-all text-left shadow-sm">
                        <div class="text-2xl mr-4">üë©‚Äç‚öïÔ∏è</div>
                        <div><h3 class="font-bold text-sm text-slate-700">Chuy√™n Gia</h3><p class="text-[11px] text-slate-400">Khoa h·ªçc, gi·∫£i ph√°p chuy√™n s√¢u</p></div>
                    </button>
                </div>
                <div class="flex flex-col gap-3">
                    <button onclick="showScreen('#landing-page')" class="text-sm text-slate-400 underline">Quay l·∫°i trang ch·ªß</button>
                    <button onclick="triggerQuickExit()" class="w-full bg-red-600 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2 active:scale-95">
                        <i data-lucide="log-out" class="w-4 h-4"></i> THO√ÅT NHANH SANG GOOGLE
                    </button>
                </div>
            </div>
        </div>

        <!-- Chat UI -->
        <div id="multi-chat-ui" class="flex flex-col h-full opacity-0 hidden-screen">
            <header class="h-16 flex items-center justify-between px-4 glass-panel shrink-0 z-10">
                <button onclick="resetMultiChat()"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
                <div class="flex flex-col items-center">
                    <span id="multi-bot-avatar" class="text-lg leading-none">ü§ñ</span>
                    <span id="multi-bot-name" class="text-[10px] font-bold mt-1 text-indigo-600 uppercase">TEEN WHISPER</span>
                </div>
                <button onclick="triggerQuickExit()" class="text-red-500 font-bold text-xs border border-red-100 px-2 py-1 rounded-full">THO√ÅT</button>
            </header>
            <main id="multi-chat-container" class="flex-grow p-4 overflow-y-auto no-scrollbar space-y-4 pt-6 bg-[#F1F5F9]/30">
                <div id="multi-message-list" class="space-y-4"></div>
                <div id="multi-typing" class="hidden flex gap-2"><div class="bubble-bot px-4 py-3 flex gap-1"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div>
                <div id="multi-anchor" class="h-20"></div>
            </main>
            <footer class="bg-white border-t chat-footer-elevated px-4 pt-4 shadow-lg">
                <div class="max-w-3xl mx-auto flex items-end gap-2">
                    <textarea id="multi-chat-input" rows="1" class="chat-input-global flex-grow bg-slate-100 rounded-2xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-300 outline-none resize-none transition-all" placeholder="Nh·∫≠p tin nh·∫Øn t√¢m s·ª±..." oninput="autoExpand(this)"></textarea>
                    <button onclick="sendMultiMessage()" class="chat-btn-global bg-indigo-600 text-white p-3 rounded-xl shadow-lg active:scale-90 transition-all"><i data-lucide="send" class="w-5 h-5"></i></button>
                </div>
            </footer>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- M√ÄN H√åNH 3: TH∆Ø VI·ªÜN -->
    <!-- ============================================ -->
    <div id="library-page" class="hidden-screen fixed inset-0 z-[70] bg-[#F8FAFC] flex flex-col">
        <header class="h-16 flex items-center justify-between px-4 glass-panel shrink-0">
            <button onclick="showScreen('#landing-page')" class="p-2 hover:bg-slate-100 rounded-full transition-colors"><i data-lucide="arrow-left" class="w-6 h-6"></i></button>
            <h1 class="font-display font-bold text-lg text-brand-dark">Th∆∞ vi·ªán Ki·∫øn th·ª©c</h1>
            <button onclick="triggerQuickExit()" class="bg-red-50 text-red-600 px-3 py-1.5 rounded-full text-xs font-bold border border-red-100">Tho√°t</button>
        </header>
        <div class="px-4 py-4 shrink-0 bg-white shadow-sm">
            <div class="relative max-w-2xl mx-auto">
                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                <input type="text" id="lib-search" oninput="searchArticles()" class="w-full pl-12 pr-4 py-3 rounded-2xl border-none bg-slate-100 outline-none shadow-inner" placeholder="T√¨m m·ª•n, chi·ªÅu cao, √°p l·ª±c, crush...">
            </div>
        </div>
        <div class="flex-grow overflow-y-auto no-scrollbar p-4" id="lib-scroll-area">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 pb-24" id="article-grid"></div>
        </div>
        <nav class="h-20 glass-panel flex justify-around items-center px-4 shrink-0 bg-white/90">
            <button onclick="showScreen('#companion-chat')" class="flex flex-col items-center text-slate-400 hover:text-indigo-600 transition-colors"><i data-lucide="message-circle-heart" class="w-6 h-6"></i><span class="text-[10px] font-bold">Chat</span></button>
            <button onclick="showScreen('#landing-page')" class="w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center text-white shadow-lg -mt-8 border-4 border-white transition-transform hover:scale-110">T</button>
            <button class="flex flex-col items-center text-indigo-600"><i data-lucide="book-open" class="w-6 h-6"></i><span class="text-[10px] font-bold">Th∆∞ vi·ªán</span></button>
        </nav>
    </div>

    <!-- ============================================ -->
    <!-- M√ÄN H√åNH 4: CHI TI·∫æT B√ÄI VI·∫æT (M·ªöI) -->
    <!-- ============================================ -->
    <div id="article-detail" class="hidden-screen fixed inset-0 z-[90] bg-white flex flex-col">
        <header class="h-16 flex items-center px-4 border-b">
            <button onclick="closeArticle()"><i data-lucide="x" class="w-6 h-6 text-slate-500"></i></button>
            <span class="ml-4 font-bold text-slate-800" id="detail-header-title">Th√¥ng tin chi ti·∫øt</span>
        </header>
        <main class="flex-grow overflow-y-auto p-6 space-y-6 no-scrollbar">
            <img id="detail-img" class="w-full h-56 object-cover rounded-3xl shadow-lg">
            <div>
                <span id="detail-tag" class="text-[10px] font-bold px-2 py-1 rounded-lg bg-indigo-50 text-indigo-600 uppercase"></span>
                <h1 id="detail-title" class="text-2xl font-display font-bold text-slate-800 mt-4 leading-tight"></h1>
            </div>
            <p id="detail-content" class="text-slate-600 leading-relaxed text-sm"></p>
            <div class="bg-indigo-50 p-5 rounded-2xl border border-indigo-100 mt-6">
                <p class="text-xs text-indigo-600 font-bold mb-2 flex items-center gap-1"><i data-lucide="link" class="w-3 h-3"></i> T√åM HI·ªÇU TH√äM T·∫†I:</p>
                <a id="detail-link" href="#" target="_blank" class="text-indigo-700 font-bold text-sm underline break-all"></a>
            </div>
            <div class="h-10"></div>
        </main>
    </div>

    <!-- ============================================ -->
    <!-- M√ÄN H√åNH 5: B·∫†N T√ÇM GIAO -->
    <!-- ============================================ -->
    <div id="companion-chat" class="hidden-screen fixed inset-0 z-[100] flex flex-col bg-white">
        <header class="h-16 flex items-center justify-between px-4 border-b shrink-0 z-50 glass-panel">
            <button onclick="showScreen('#library-page')" class="p-2 hover:bg-slate-100 rounded-full transition-colors"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 rounded-full bg-indigo-100 border-2 border-white overflow-hidden flex items-center justify-center"><img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" class="w-8 h-8"></div>
                <h1 class="font-display font-bold text-slate-800 text-sm">B·∫°n T√¢m Giao</h1>
            </div>
            <button onclick="clearCompanionChat()" class="p-2 text-slate-300 hover:text-red-500 transition-colors"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
        </header>
        <main id="companion-chat-container" class="flex-grow overflow-y-auto p-4 space-y-4 no-scrollbar bg-[#F8FAFC]">
            <div id="companion-message-list" class="space-y-4 pt-4">
                <div class="flex items-end gap-2"><div class="bubble-bot px-4 py-3 max-w-[85%] text-sm">Ch√†o c·∫≠u! üëã M√¨nh c√≥ th·ªÉ gi·∫£i ƒë√°p m·ªçi th·∫Øc m·∫Øc c·ªßa c·∫≠u. C·∫≠u mu·ªën h·ªèi v·ªÅ g√¨?</div></div>
            </div>
            <div id="companion-typing" class="hidden flex gap-1"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>
            <div id="companion-anchor" class="h-32"></div>
        </main>
        <footer class="bg-white border-t chat-footer-elevated px-4 pt-3 shadow-lg">
            <div class="flex gap-2 overflow-x-auto pb-3 no-scrollbar mb-3" id="companion-quick-chips"></div>
            <div class="max-w-3xl mx-auto flex items-end gap-2">
                <textarea id="companion-chat-input" rows="1" class="chat-input-global flex-grow bg-slate-100 rounded-2xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-300 outline-none resize-none" placeholder="T√¢m s·ª± ƒëi c·∫≠u..." oninput="autoExpand(this)"></textarea>
                <button onclick="sendCompanionMessage()" class="chat-btn-global bg-indigo-600 text-white p-3 rounded-xl shadow-lg active:scale-90"><i data-lucide="send" class="w-5 h-5"></i></button>
            </div>
        </footer>
    </div>

    <!-- M√ÄN H√åNH KH·∫®N C·∫§P -->
    <div id="emergency-overlay" class="fixed inset-0 danger-overlay hidden flex flex-col items-center justify-center p-6 text-white text-center">
        <i data-lucide="heart" class="w-24 h-24 mb-6 text-white animate-pulse"></i>
        <h2 class="text-3xl font-bold mb-4 font-display leading-tight">C·∫≠u kh√¥ng m·ªôt m√¨nh ƒë√¢u!</h2>
        <p class="max-w-xs mb-8 text-lg font-medium opacity-90">ƒê·ª´ng c√≥ suy nghƒ© ti√™u c·ª±c, c√≥ m√¨nh lu√¥n ·ªü ƒë√¢y v·ªõi b·∫°n. H√£y ƒë·ªÉ c√°c chuy√™n gia gi√∫p c·∫≠u nh√©!</p>
        <a href="tel:111" class="w-full max-w-xs bg-white text-red-600 font-bold py-5 rounded-2xl shadow-2xl flex items-center justify-center gap-3 text-xl mb-4 hover:scale-105 transition-all">
            <i data-lucide="phone-call"></i> G·ªåI T·ªîNG ƒê√ÄI 111
        </a>
        <button onclick="document.getElementById('emergency-overlay').classList.add('hidden')" class="underline opacity-70 hover:opacity-100 transition-opacity">T√¥i ·ªïn r·ªìi, quay l·∫°i chat</button>
    </div>

    <!-- SCRIPTS -->
    <script>
        lucide.createIcons();

        // 1. C·∫§U H√åNH AN TO√ÄN TO√ÄN C·∫¶U
        const DANGER_WORDS = ['ch·∫øt', 'nh·∫£y l·∫ßu', 't·ª± t·ª≠', 't·ª± s√°t', 'kh√¥ng mu·ªën s·ªëng', 'nh·∫£y c·∫ßu', 'suicide', 'die', 'k·∫øt li·ªÖu'];
        const SWEAR_WORDS = ['dcm', 'ƒë·ªãt', 'c√∫t', 'cmm', 'm·∫π m√†y', 'm·ªçe', 'vcl', 'ƒëm', 'l·ªìn', 'cc', 'ƒë√©o'];
        
        let swearCount = 0;
        let isLocked = false;
        let lockTimer = null;

        function updateAllInputs(locked, message = "Nh·∫≠p tin nh·∫Øn...") {
            const inputs = document.querySelectorAll('.chat-input-global');
            const btns = document.querySelectorAll('.chat-btn-global');
            inputs.forEach(input => {
                input.disabled = locked;
                input.placeholder = message;
                input.style.opacity = locked ? "0.5" : "1";
            });
            btns.forEach(btn => {
                btn.disabled = locked;
                btn.style.opacity = locked ? "0.5" : "1";
            });
        }

        function lockGlobalChat(seconds) {
            isLocked = true;
            let timeLeft = seconds;
            
            if(lockTimer) clearInterval(lockTimer);
            
            updateAllInputs(true, `B·ªã kh√≥a trong ${timeLeft}s...`);

            lockTimer = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                    clearInterval(lockTimer);
                    isLocked = false;
                    updateAllInputs(false, "Nh·∫≠p tin nh·∫Øn...");
                } else {
                    updateAllInputs(true, `B·ªã kh√≥a trong ${timeLeft}s...`);
                }
            }, 1000);
        }

        function checkSafety(text) {
            const lowText = text.toLowerCase();
            if (DANGER_WORDS.some(word => lowText.includes(word))) {
                document.getElementById('emergency-overlay').classList.remove('hidden');
                return 'danger';
            }
            if (SWEAR_WORDS.some(word => lowText.includes(word))) {
                swearCount++;
                if (swearCount <= 2) return "C·∫≠u ∆°i, ƒë·ª´ng d√πng nh·ªØng t·ª´ ng·ªØ nh∆∞ v·∫≠y nh√©. H√£y t√¥n tr·ªçng nhau n√®! üòä";
                if (swearCount === 3) return "C·∫¢NH B√ÅO: N·∫øu c·∫≠u ti·∫øp t·ª•c d√πng t·ª´ ng·ªØ kh√¥ng ph√π h·ª£p, m√¨nh s·∫Ω kh√≥a chat c·ªßa c·∫≠u!";
                if (swearCount === 4) {
                    lockGlobalChat(60); // 1 ph√∫t
                    return "B·∫†N ƒê√É B·ªä KH√ìA CHAT 1 PH√öT TR√äN TO√ÄN H·ªÜ TH·ªêNG.";
                }
                if (swearCount >= 5) {
                    lockGlobalChat(600); // 10 ph√∫t
                    return "B·∫†N ƒê√É B·ªä KH√ìA CHAT 10 PH√öT TR√äN TO√ÄN H·ªÜ TH·ªêNG.";
                }
            }
            return 'safe';
        }

        // 2. D·ªÆ LI·ªÜU TH∆Ø VI·ªÜN (50 CH·ª¶ ƒê·ªÄ)
        const libraryData = [
            { id: 1, tag: 'D·∫¨Y TH√å', title: "M·ª•n tr·ª©ng c√° & C√°ch x·ª≠ l√Ω", img: "https://images.unsplash.com/photo-1596755389378-c31d21fd1273?w=500", content: "M·ª•n tr·ª©ng c√° l√† hi·ªán t∆∞·ª£ng ph·ªï bi·∫øn ·ªü tu·ªïi d·∫≠y th√¨ do thay ƒë·ªïi n·ªôi ti·∫øt t·ªë. ƒê·ªÉ h·∫°n ch·∫ø m·ª•n, h√£y r·ª≠a m·∫∑t 2 l·∫ßn m·ªói ng√†y, kh√¥ng t·ª± √Ω n·∫∑n m·ª•n v√† gi·ªØ ga g·ªëi lu√¥n s·∫°ch s·∫Ω.", link: "https://suckhoedoisong.vn/mun-trung-ca-tuoi-day-thi-nguyen-nhan-va-cach-dieu-tri-169211019154407833.htm", search: "mun trung ca" },
            { id: 2, tag: 'TH·ªÇ CH·∫§T', title: "C√°ch tƒÉng chi·ªÅu cao t·ªëi ƒëa", img: "https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=500", content: "ƒê·ªÉ cao l·ªõn h∆°n, b·∫°n c·∫ßn ng·ªß tr∆∞·ªõc 22h ƒë√™m ƒë·ªÉ hormone tƒÉng tr∆∞·ªüng ho·∫°t ƒë·ªông m·∫°nh nh·∫•t, u·ªëng 500ml s·ªØa m·ªói ng√†y v√† t·∫≠p c√°c b√†i k√©o gi√£n nh∆∞ h√≠t x√† ho·∫∑c b∆°i l·ªôi.", link: "https://moh.gov.vn/chuong-trinh-muc-tieu-quoc-gia/-/asset_publisher/7NG969m9N9N/content/bi-quyet-giup-tre-tang-chieu-cao-toi-u", search: "chieu cao" },
            { id: 3, tag: 'T√åNH C·∫¢M', title: "V∆∞·ª£t qua c√∫ s·ªëc th·∫•t t√¨nh", img: "https://images.unsplash.com/photo-1516575334481-f85287c2c82d?w=500", content: "C·∫£m gi√°c ƒëau bu·ªìn khi chia tay l√† b√¨nh th∆∞·ªùng. H√£y cho ph√©p b·∫£n th√¢n ƒë∆∞·ª£c kh√≥c, nh∆∞ng sau ƒë√≥ h√£y t·∫≠p trung v√†o c√°c s·ªü th√≠ch m·ªõi v√† d√†nh th·ªùi gian cho b·∫°n b√® th√¢n thi·∫øt.", link: "https://vov.vn/doi-song/tam-ly/cach-vuot-qua-cu-soc-khi-chia-tay-nguoi-yeu-879412.vov", search: "crush thich yeu" },
            { id: 4, tag: 'H·ªåC T·∫¨P', title: "Ph∆∞∆°ng ph√°p Pomodoro hi·ªáu qu·∫£", img: "https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=500", content: "Pomodoro l√† k·ªπ thu·∫≠t qu·∫£n l√Ω th·ªùi gian: H·ªçc t·∫≠p trung 25 ph√∫t, ngh·ªâ 5 ph√∫t. Sau 4 l·∫ßn nh∆∞ v·∫≠y th√¨ ngh·ªâ d√†i h∆°n 15-30 ph√∫t. C√°ch n√†y gi√∫p n√£o b·ªô lu√¥n t·ªânh t√°o.", link: "https://www.studytienganh.vn/news/1012/pomodoro-la-gi-cach-hoc-tap-va-lam-viec-theo-phuong-phap-pomodoro", search: "hoc tap thi cu" },
            { id: 5, tag: 'S·ª®C KH·ªéE', title: "M·∫•t ng·ªß ·ªü tu·ªïi Teen", img: "https://images.unsplash.com/photo-1511295742364-917e70331821?w=500", content: "M·∫•t ng·ªß l√†m gi·∫£m tr√≠ nh·ªõ v√† s·ª± t·∫≠p trung. H√£y b·ªè ƒëi·ªán tho·∫°i √≠t nh·∫•t 30 ph√∫t tr∆∞·ªõc khi ng·ªß, ng√¢m ch√¢n n∆∞·ªõc ·∫•m ho·∫∑c u·ªëng m·ªôt ly s·ªØa ·∫•m ƒë·ªÉ d·ªÖ ng·ªß h∆°n nh√©.", link: "https://vinmec.com/vi/tin-tuc/suc-khoe-tong-quat/tai-sao-tre-tuoi-day-thi-hay-bi-mat-ngu/", search: "ngu thuc khuya" }
        ];

        for(let i=6; i<=50; i++) {
            libraryData.push({ id: i, tag: 'KI·∫æN TH·ª®C', title: `Ch·ªß ƒë·ªÅ t∆∞ v·∫•n h·ªØu √≠ch s·ªë ${i}`, img: `https://picsum.photos/seed/${i+50}/500/300`, content: "N·ªôi dung ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t ƒë·ªÉ cung c·∫•p cho b·∫°n nh·ªØng l·ªùi khuy√™n b·ªï √≠ch nh·∫•t v·ªÅ cu·ªôc s·ªëng v√† s·ª©c kh·ªèe tu·ªïi m·ªõi l·ªõn. H√£y c√πng ƒë√≥n ch·ªù nh√©!", link: "https://google.com", search: "kien thuc moi" });
        }

        const grid = document.getElementById('article-grid');
        libraryData.forEach(item => {
            const art = document.createElement('article');
            art.className = 'article-item bg-white rounded-3xl overflow-hidden shadow-sm border border-slate-100 hover:shadow-md transition-all cursor-pointer group';
            art.setAttribute('data-search', item.search + " " + item.title.toLowerCase());
            art.onclick = () => openArticle(item);
            art.innerHTML = `<div class="h-40 overflow-hidden relative"><img src="${item.img}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"><span class="absolute top-3 left-3 bg-white/90 px-2 py-1 rounded-lg text-[9px] font-bold text-indigo-600">${item.tag}</span></div><div class="p-4"><h3 class="font-bold text-slate-800 text-sm leading-tight">${item.title}</h3></div>`;
            grid.appendChild(art);
        });

        function openArticle(item) {
            document.getElementById('detail-img').src = item.img;
            document.getElementById('detail-tag').innerText = item.tag;
            document.getElementById('detail-title').innerText = item.title;
            document.getElementById('detail-content').innerText = item.content;
            document.getElementById('detail-link').href = item.link;
            document.getElementById('detail-link').innerText = item.link;
            const detailScreen = document.getElementById('article-detail');
            detailScreen.classList.remove('hidden-screen');
            gsap.fromTo(detailScreen, {y: '100%'}, {y: 0, duration: 0.4, ease: "power2.out"});
            lucide.createIcons();
        }

        function closeArticle() {
            gsap.to('#article-detail', {y: '100%', duration: 0.4, onComplete: () => {
                document.getElementById('article-detail').classList.add('hidden-screen');
            }});
        }

        // 3. LOGIC CHAT (H·ª¢P NH·∫§T AN TO√ÄN)
        const botBrain = [
            { keywords: ['m·ª•n', 'da'], responses: { friend: "M·ª•n ch√°n x·ªâu! üò© ƒê·ª´ng n·∫∑n nha, s·∫πo ƒë√≥. R·ª≠a m·∫∑t k·ªπ v√†o bro!", parent: "Con ƒë·ª´ng lo, d·∫≠y th√¨ ai c≈©ng b·ªã. ƒê·ªÉ m·∫π mua s·ªØa r·ª≠a m·∫∑t cho nhen.", expert: "M·ª•n l√† do b√£ nh·ªùn tƒÉng ti·∫øt. Em n√™n l√†m s·∫°ch da 2 b∆∞·ªõc nh√©.", companion: "M·ª•n d·∫≠y th√¨ x·ª≠ l√Ω ƒë∆°n gi·∫£n: R·ª≠a m·∫∑t 2 l·∫ßn/ng√†y v√† u·ªëng nhi·ªÅu n∆∞·ªõc nh√©! üåø" }},
            { keywords: ['cao', 'chi·ªÅu cao'], responses: { friend: "ƒêi b∆°i ƒë√™ bro! üèä‚Äç‚ôÇÔ∏è U·ªëng s·ªØa thay n∆∞·ªõc l·ªçc lu√¥n kkk.", parent: "ƒÇn nhi·ªÅu canxi v√† ng·ªß tr∆∞·ªõc 10h t·ªëi ƒëi con.", expert: "Em c·∫ßn k·∫øt h·ª£p Dinh d∆∞·ª°ng v√† v·∫≠n ƒë·ªông gi√£n c∆°.", companion: "ƒê·ªÉ cao h∆°n, c·∫≠u h√£y ng·ªß tr∆∞·ªõc 10h ƒë√™m v√† t·∫≠p h√≠t x√† ƒë∆°n nh√©! üèÄ" }}
        ];

        function handleBot(text, role, listId, typingId) {
            const safetyStatus = checkSafety(text);
            if (safetyStatus === 'danger') return;
            
            document.getElementById(typingId).classList.remove('hidden');
            setTimeout(() => {
                document.getElementById(typingId).classList.add('hidden');
                let reply = (safetyStatus !== 'safe') ? safetyStatus : 
                            (botBrain.find(b => b.keywords.some(k => text.toLowerCase().includes(k)))?.responses[role] || "M√¨nh ƒëang nghe c·∫≠u ƒë√¢y, k·ªÉ ti·∫øp ƒëi...");
                appendMsg(listId, reply, 'bot');
            }, 1000);
        }

        // 4. LOGIC M√ÄN H√åNH & CHIPS
        function showScreen(screenId) {
            const screens = ['#landing-page', '#multi-dim-chat', '#companion-chat', '#library-page'];
            screens.forEach(s => {
                const el = document.querySelector(s);
                if(s === screenId) {
                    el.classList.remove('hidden-screen');
                    gsap.fromTo(s, {opacity: 0, y: 20}, {opacity: 1, y: 0, duration: 0.4});
                } else { el.classList.add('hidden-screen'); }
            });
            lucide.createIcons();
            // ƒê·∫£m b·∫£o tr·∫°ng th√°i kh√≥a ƒë∆∞·ª£c c·∫≠p nh·∫≠t khi chuy·ªÉn m√†n h√¨nh
            if(isLocked) updateAllInputs(true, `B·ªã kh√≥a...`);
        }

        function triggerQuickExit() { window.location.replace("https://www.google.com"); }
        function autoExpand(t) { t.style.height = 'auto'; t.style.height = t.scrollHeight + 'px'; }

        let multiRole = 'friend';
        function selectRole(role) {
            multiRole = role;
            gsap.to('#role-selection-screen', {opacity: 0, duration: 0.3, onComplete: () => {
                document.getElementById('role-selection-screen').classList.add('hidden-screen');
                const ui = document.getElementById('multi-chat-ui');
                ui.classList.remove('hidden-screen');
                gsap.to(ui, {opacity: 1, duration: 0.3});
                const names = { friend: 'B·∫°n Th√¢n', parent: 'B·ªë M·∫π T√¢m L√Ω', expert: 'Chuy√™n Gia' };
                document.getElementById('multi-bot-avatar').innerText = { friend: 'üòé', parent: 'üè°', expert: 'üë©‚Äç‚öïÔ∏è' }[role];
                appendMsg('multi-message-list', `Ch√†o c·∫≠u, m√¨nh l√† ${names[role]}. C·∫≠u c·∫ßn t√¢m s·ª± g√¨ kh√¥ng?`, 'bot');
            }});
        }

        function resetMultiChat() {
            document.getElementById('multi-chat-ui').classList.add('hidden-screen');
            document.getElementById('role-selection-screen').classList.remove('hidden-screen');
            document.getElementById('role-selection-screen').style.opacity = 1;
            document.getElementById('multi-message-list').innerHTML = '';
        }

        function sendMultiMessage() {
            const input = document.getElementById('multi-chat-input');
            const text = input.value.trim();
            if(!text || isLocked) return;
            appendMsg('multi-message-list', text, 'user');
            input.value = '';
            input.style.height = 'auto';
            handleBot(text, multiRole, 'multi-message-list', 'multi-typing');
        }

        function sendCompanionMessage() {
            const input = document.getElementById('companion-chat-input');
            const text = input.value.trim();
            if(!text || isLocked) return;
            appendMsg('companion-message-list', text, 'user');
            input.value = '';
            input.style.height = 'auto';
            handleBot(text, 'companion', 'companion-message-list', 'companion-typing');
        }

        const companionQuickChips = [
            { text: "M·ª•n x·ª≠ l√Ω sao?", icon: "üåø" }, { text: "C√°ch cao th√™m?", icon: "üìè" }, 
            { text: "√Åp l·ª±c qu√°!", icon: "üìö" }, { text: "C√°ch t·ªè t√¨nh?", icon: "üíò" }
        ];
        const chipsContainer = document.getElementById('companion-quick-chips');
        companionQuickChips.forEach(chip => {
            const btn = document.createElement('button');
            btn.className = "whitespace-nowrap bg-white border border-slate-100 text-slate-600 text-[11px] font-bold px-4 py-2 rounded-full shadow-sm";
            btn.innerHTML = `${chip.icon} ${chip.text}`;
            btn.onclick = () => { if(!isLocked) { document.getElementById('companion-chat-input').value = chip.text; sendCompanionMessage(); } };
            chipsContainer.appendChild(btn);
        });

        function appendMsg(listId, text, sender) {
            const list = document.getElementById(listId);
            const div = document.createElement('div');
            div.className = sender === 'user' ? 'flex justify-end' : 'flex items-end gap-2';
            div.innerHTML = `<div class="p-3 rounded-2xl text-sm ${sender === 'user' ? 'bubble-user' : 'bubble-bot'} shadow-sm max-w-[85%]">${text}</div>`;
            list.appendChild(div);
            const container = list.parentElement;
            container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
        }

        function searchArticles() {
            const query = document.getElementById('lib-search').value.toLowerCase();
            document.querySelectorAll('.article-item').forEach(item => {
                item.style.display = item.getAttribute('data-search').includes(query) ? 'block' : 'none';
            });
        }

        function clearCompanionChat() { if(confirm("X√≥a l·ªãch s·ª≠ chat?")) document.getElementById('companion-message-list').innerHTML = ''; }
    </script>
</body>
</html>