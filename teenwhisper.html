<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Teen Whisper - H·ªá Sinh Th√°i To√†n Di·ªán</title>
    
    <!-- FONTS & ICONS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'], display: ['"Quicksand"', 'sans-serif'] },
                    colors: {
                        brand: { blue: '#E0F2FE', pink: '#FCE7F3', purple: '#F3E8FF', primary: '#6366F1', text: '#334155' }
                    },
                    animation: { 'float': 'float 6s ease-in-out infinite', 'blob': 'blob 10s infinite' }
                }
            }
        }
    </script>

    <style>
        body { background-color: #F8FAFC; overflow-x: hidden; height: 100vh; margin: 0; }
        .glass-panel { background: rgba(255, 255, 255, 0.75); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); }
        .blob-bg { position: absolute; filter: blur(60px); z-index: -1; opacity: 0.6; }
        .bubble-user { background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); color: white; border-radius: 18px 18px 4px 18px; }
        .bubble-bot { background: white; color: #334155; border-radius: 18px 18px 18px 4px; border: 1px solid #F1F5F9; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .typing-dot { width: 6px; height: 6px; background-color: #94A3B8; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .hidden-screen { display: none !important; }
        .chat-footer-elevated { padding-bottom: calc(2rem + env(safe-area-inset-bottom)); }
        .danger-overlay { background: rgba(220, 38, 38, 0.98); backdrop-filter: blur(10px); z-index: 1000; }
        
        /* Music Card Style */
        .music-card { background: #F8FAFC; border: 1px solid #E2E8F0; border-radius: 12px; padding: 10px; margin-top: 8px; display: flex; align-items: center; gap: 12px; }
    </style>
</head>
<body class="text-brand-text relative h-full">

    <div class="blob-bg bg-blue-200 w-96 h-96 rounded-full top-0 left-0 animate-blob"></div>
    <div class="blob-bg bg-purple-200 w-96 h-96 rounded-full bottom-0 right-0 animate-blob animation-delay-2000"></div>

    <!-- ============================================ -->
    <!-- M√ÄN H√åNH 1: TRANG CH·ª¶ -->
    <!-- ============================================ -->
    <div id="landing-page" class="flex flex-col h-full w-full relative z-10">
        <header class="w-full p-4 flex justify-between items-center z-50 fixed top-0 bg-white/30 backdrop-blur-md border-b border-white/20">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold shadow-lg">T</div>
                <span class="font-display font-bold text-lg text-indigo-900">TeenWhisper</span>
            </div>
            <button onclick="triggerQuickExit()" class="bg-red-50 text-red-600 px-4 py-2 rounded-full border border-red-200 text-sm font-semibold shadow-sm">Tho√°t nhanh Google</button>
        </header>

        <main class="flex-grow flex items-center justify-center pt-24 pb-12 px-4">
            <div class="container max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                <div class="order-2 md:order-1 text-center md:text-left space-y-6">
                    <h1 class="font-display text-4xl md:text-6xl font-bold text-slate-800 leading-tight">Ch√†o b·∫°n, m√¨nh l√† <span class="text-indigo-600">Teen Whisper</span></h1>
                    <p class="text-lg text-slate-600">L·∫Øng nghe m·ªçi t√¢m t∆∞ c·ªßa c·∫≠u. ·∫®n danh. B·∫£o m·∫≠t. Kh√¥ng ph√°n x√©t.</p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                        <button onclick="showScreen('#multi-dim-chat')" class="bg-indigo-600 text-white px-8 py-4 rounded-2xl shadow-xl hover:scale-105 active:scale-95 flex items-center gap-3 font-semibold text-lg transition-all">
                            <i data-lucide="message-circle-heart"></i><span>B·∫Øt ƒë·∫ßu tr√≤ chuy·ªán</span>
                        </button>
                        <button onclick="showScreen('#library-page')" class="bg-white text-indigo-900 border border-indigo-100 px-8 py-4 rounded-2xl shadow-sm flex items-center gap-3 font-semibold text-lg transition-all">
                            <i data-lucide="book-open"></i><span>Kh√°m ph√° th∆∞ vi·ªán</span>
                        </button>
                    </div>
                </div>
                <div class="order-1 md:order-2 flex justify-center mascot-col">
                    <div class="animate-float w-64 h-64 md:w-96 md:h-96 rounded-full bg-gradient-to-tr from-indigo-200 to-pink-200 flex items-center justify-center shadow-2xl glass-panel relative">
                        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" class="w-[75%] h-[75%] object-contain">
                        <div class="absolute -top-4 -right-4 bg-white px-4 py-2 rounded-xl shadow-lg text-indigo-600 font-bold animate-bounce text-sm">üëã Ch√†o c·∫≠u!</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ============================================ -->
    <!-- M√ÄN H√åNH 2: CHAT ƒêA CHI·ªÄU (B·ªê M·∫∏, B·∫†N B√à, CHUY√äN GIA) -->
    <!-- ============================================ -->
    <div id="multi-dim-chat" class="hidden-screen fixed inset-0 z-[60] flex flex-col h-full bg-[#F8FAFC]">
        <div id="role-selection-screen" class="absolute inset-0 z-50 flex flex-col items-center justify-center p-6 bg-white/40 backdrop-blur-md">
            <div class="glass-panel p-8 rounded-3xl shadow-2xl max-w-md w-full text-center">
                <h1 class="text-2xl font-display font-bold text-slate-800 mb-6">B·∫°n mu·ªën t√¢m s·ª± v·ªõi ai?</h1>
                <div class="space-y-3 mb-6">
                    <button onclick="selectRole('friend')" class="w-full flex items-center p-4 rounded-xl border bg-white hover:bg-indigo-50 transition-all text-left shadow-sm">
                        <div class="text-2xl mr-4">üòé</div>
                        <div><h3 class="font-bold text-sm text-slate-700">Ng∆∞·ªùi B·∫°n Th√¢n</h3><p class="text-[11px] text-slate-400">Ng√¥n ng·ªØ Gen Z, x·∫£ stress c·ª±c m·∫°nh</p></div>
                    </button>
                    <button onclick="selectRole('parent')" class="w-full flex items-center p-4 rounded-xl border bg-white hover:bg-orange-50 transition-all text-left shadow-sm">
                        <div class="text-2xl mr-4">üè°</div>
                        <div><h3 class="font-bold text-sm text-slate-700">B·ªë M·∫π T√¢m L√Ω</h3><p class="text-[11px] text-slate-400">·∫§m √°p, th·∫•u hi·ªÉu, y√™u th∆∞∆°ng</p></div>
                    </button>
                    <button onclick="selectRole('expert')" class="w-full flex items-center p-4 rounded-xl border bg-white hover:bg-teal-50 transition-all text-left shadow-sm">
                        <div class="text-2xl mr-4">üë©‚Äç‚öïÔ∏è</div>
                        <div><h3 class="font-bold text-sm text-slate-700">Chuy√™n Gia</h3><p class="text-[11px] text-slate-400">Khoa h·ªçc, gi·∫£i ph√°p chuy√™n s√¢u</p></div>
                    </button>
                </div>
                <div class="flex flex-col gap-3">
                    <button onclick="showScreen('#landing-page')" class="text-sm text-slate-400 underline">Quay l·∫°i trang ch·ªß</button>
                    <button onclick="triggerQuickExit()" class="w-full bg-red-600 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-all">
                        <i data-lucide="log-out" class="w-4 h-4"></i> THO√ÅT NHANH SANG GOOGLE
                    </button>
                </div>
            </div>
        </div>

        <div id="multi-chat-ui" class="flex flex-col h-full opacity-0 hidden-screen">
            <header class="h-16 flex items-center justify-between px-4 glass-panel shrink-0 z-10">
                <button onclick="resetMultiChat()"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
                <div class="flex flex-col items-center">
                    <span id="multi-bot-avatar" class="text-lg leading-none">ü§ñ</span>
                    <span id="multi-bot-name" class="text-[10px] font-bold mt-1 text-indigo-600 uppercase tracking-widest">TEEN WHISPER</span>
                </div>
                <button onclick="triggerQuickExit()" class="text-red-500 font-bold text-xs border border-red-100 px-2 py-1 rounded-full">THO√ÅT</button>
            </header>
            <main id="multi-chat-container" class="flex-grow p-4 overflow-y-auto no-scrollbar space-y-4 pt-6 bg-[#F1F5F9]/30">
                <div id="multi-message-list" class="space-y-4"></div>
                <div id="multi-typing" class="hidden flex gap-2"><div class="bubble-bot px-4 py-3 flex gap-1"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div>
                <div id="multi-anchor" class="h-10"></div>
            </main>
            <footer class="bg-white border-t chat-footer-elevated px-4 pt-4 shadow-lg">
                <div class="max-w-3xl mx-auto flex items-end gap-2">
                    <textarea id="multi-chat-input" rows="1" class="chat-input-global flex-grow bg-slate-100 rounded-2xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-300 outline-none resize-none transition-all" placeholder="Nh·∫≠p tin nh·∫Øn t√¢m s·ª±..." oninput="autoExpand(this)"></textarea>
                    <button onclick="sendMultiMessage()" class="chat-btn-global bg-indigo-600 text-white p-3 rounded-xl shadow-lg active:scale-90 transition-all"><i data-lucide="send" class="w-5 h-5"></i></button>
                </div>
            </footer>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- M√ÄN H√åNH 3: TH∆Ø VI·ªÜN 50 CH·ª¶ ƒê·ªÄ -->
    <!-- ============================================ -->
    <div id="library-page" class="hidden-screen fixed inset-0 z-[70] bg-[#F8FAFC] flex flex-col">
        <header class="h-16 flex items-center justify-between px-4 glass-panel shrink-0">
            <button onclick="showScreen('#landing-page')" class="p-2 hover:bg-slate-100 rounded-full transition-colors"><i data-lucide="arrow-left" class="w-6 h-6"></i></button>
            <h1 class="font-display font-bold text-lg text-brand-dark">Th∆∞ vi·ªán Ki·∫øn th·ª©c</h1>
            <button onclick="triggerQuickExit()" class="bg-red-50 text-red-600 px-3 py-1.5 rounded-full text-xs font-bold border border-red-100">Tho√°t</button>
        </header>
        <div class="px-4 py-4 shrink-0 bg-white shadow-sm">
            <div class="relative max-w-2xl mx-auto">
                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                <input type="text" id="lib-search" oninput="searchArticles()" class="w-full pl-12 pr-4 py-3 rounded-2xl border-none bg-slate-100 outline-none shadow-inner" placeholder="T√¨m m·ª•n, chi·ªÅu cao, √°p l·ª±c, crush...">
            </div>
        </div>
        <div class="flex-grow overflow-y-auto no-scrollbar p-4" id="lib-scroll-area">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 pb-24" id="article-grid"></div>
            <div id="empty-search" class="hidden text-center py-20 text-slate-400 italic">Kh√¥ng t√¨m th·∫•y ch·ªß ƒë·ªÅ n√†y... üò¢</div>
        </div>
        <nav class="h-20 glass-panel flex justify-around items-center px-4 shrink-0 bg-white/90">
            <button onclick="showScreen('#companion-chat')" class="flex flex-col items-center text-slate-400 hover:text-indigo-600 transition-colors"><i data-lucide="message-circle-heart" class="w-6 h-6"></i><span class="text-[10px] font-bold">Chat</span></button>
            <button onclick="showScreen('#landing-page')" class="w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center text-white shadow-lg -mt-8 border-4 border-white transition-transform hover:scale-110">T</button>
            <button class="flex flex-col items-center text-indigo-600"><i data-lucide="book-open" class="w-6 h-6"></i><span class="text-[10px] font-bold">Th∆∞ vi·ªán</span></button>
        </nav>
    </div>

    <!-- M√ÄN H√åNH CHI TI·∫æT B√ÄI VI·∫æT -->
    <div id="article-detail" class="hidden-screen fixed inset-0 z-[95] bg-white flex flex-col">
        <header class="h-16 flex items-center px-4 border-b shrink-0 glass-panel">
            <button onclick="closeArticle()"><i data-lucide="x" class="w-6 h-6 text-slate-500"></i></button>
            <span class="ml-4 font-bold text-slate-800 text-sm truncate" id="detail-header-title">ƒêang ƒë·ªçc...</span>
        </header>
        <main class="flex-grow overflow-y-auto p-6 space-y-6 no-scrollbar">
            <img id="detail-img" class="w-full h-56 object-cover rounded-3xl shadow-xl">
            <div class="space-y-2">
                <span id="detail-tag" class="text-[10px] font-bold px-2 py-1 rounded-lg bg-indigo-50 text-indigo-600 uppercase tracking-widest">KI·∫æN TH·ª®C</span>
                <h1 id="detail-title" class="text-2xl font-display font-bold text-slate-800 leading-tight"></h1>
            </div>
            <div id="detail-content" class="text-slate-600 leading-relaxed text-sm space-y-4"></div>
            <div class="bg-indigo-50 p-6 rounded-3xl border border-indigo-100 mt-6 shadow-inner">
                <p class="text-xs text-indigo-600 font-black mb-3 flex items-center gap-2"><i data-lucide="external-link" class="w-4 h-4"></i> T√åM HI·ªÇU S√ÇU H∆†N T·∫†I:</p>
                <a id="detail-link" href="#" target="_blank" class="text-indigo-700 font-bold text-sm underline break-all hover:text-indigo-900 transition-colors"></a>
            </div>
            <div class="h-12"></div>
        </main>
    </div>

    <!-- ============================================ -->
    <!-- M√ÄN H√åNH 4: B·∫†N T√ÇM GIAO -->
    <!-- ============================================ -->
    <div id="companion-chat" class="hidden-screen fixed inset-0 z-[100] flex flex-col bg-white">
        <header class="glass-header h-16 flex items-center justify-between px-4 border-b shrink-0 z-50 sticky top-0">
            <button onclick="showScreen('#library-page')" class="p-2 hover:bg-slate-100 rounded-full transition-colors"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 rounded-full bg-indigo-100 border-2 border-white overflow-hidden flex items-center justify-center shadow-sm"><img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png" class="w-8 h-8"></div>
                <div><h1 class="font-display font-bold text-slate-800 text-sm">B·∫°n T√¢m Giao</h1><p class="text-[10px] text-indigo-500 font-bold animate-pulse">‚óè ƒêang l·∫Øng nghe</p></div>
            </div>
            <button onclick="clearCompanionChat()" class="p-2 text-slate-300 hover:text-red-500 transition-colors"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
        </header>
        <main id="companion-chat-container" class="flex-grow overflow-y-auto p-4 space-y-4 no-scrollbar bg-[#F8FAFC]">
            <div id="companion-message-list" class="space-y-4 pt-4">
                <div class="flex items-end gap-2"><div class="bubble-bot px-4 py-3 max-w-[85%] text-sm shadow-sm border border-white">Ch√†o c·∫≠u! üëã C·∫≠u c√≥ th·∫Øc m·∫Øc g√¨ kh√¥ng n√†o? T·ªõ ·ªü ƒë√¢y l·∫Øng nghe n√®.</div></div>
            </div>
            <div id="companion-typing" class="hidden flex gap-1"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>
            <div id="companion-anchor" class="h-40"></div>
        </main>
        <footer class="bg-white border-t chat-footer-elevated px-4 pt-3 shadow-[0_-10px_20px_rgba(0,0,0,0.03)]">
            <div class="flex gap-2 overflow-x-auto pb-4 no-scrollbar mb-2" id="companion-quick-chips"></div>
            <div class="max-w-3xl mx-auto flex items-end gap-2">
                <textarea id="companion-chat-input" rows="1" class="chat-input-global flex-grow bg-slate-100 rounded-2xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-300 outline-none resize-none transition-all" placeholder="H·ªèi t·ªõ ƒëi c·∫≠u..." oninput="autoExpand(this)"></textarea>
                <button onclick="sendCompanionMessage()" class="chat-btn-global bg-indigo-600 text-white p-3 rounded-xl shadow-lg active:scale-90 transition-all"><i data-lucide="send" class="w-5 h-5"></i></button>
            </div>
        </footer>
    </div>

    <!-- M√ÄN H√åNH KH·∫®N C·∫§P -->
    <div id="emergency-overlay" class="fixed inset-0 danger-overlay hidden flex flex-col items-center justify-center p-6 text-white text-center">
        <i data-lucide="heart" class="w-24 h-24 mb-6 text-white animate-pulse"></i>
        <h2 class="text-3xl font-bold mb-4 font-display leading-tight">C·∫≠u kh√¥ng m·ªôt m√¨nh ƒë√¢u!</h2>
        <p class="max-w-xs mb-8 text-lg font-medium opacity-90 leading-relaxed">ƒê·ª´ng c√≥ suy nghƒ© ti√™u c·ª±c, c√≥ m√¨nh lu√¥n ·ªü ƒë√¢y v·ªõi b·∫°n. H√£y ƒë·ªÉ c√°c chuy√™n gia gi√∫p c·∫≠u nh√©!</p>
        <a href="tel:111" class="w-full max-w-xs bg-white text-red-600 font-bold py-5 rounded-3xl shadow-2xl flex items-center justify-center gap-3 text-xl mb-4 hover:scale-105 transition-all">
            <i data-lucide="phone-call"></i> G·ªåI T·ªîNG ƒê√ÄI 111
        </a>
        <button onclick="dismissEmergency()" class="underline opacity-70 hover:opacity-100 transition-opacity">T√¥i ·ªïn r·ªìi, quay l·∫°i chat</button>
    </div>

    <!-- SCRIPTS -->
    <script>
        lucide.createIcons();

        // 1. C·∫§U H√åNH AN TO√ÄN & √ÇM NH·∫†C
        const DANGER_WORDS = ['ch·∫øt', 'nh·∫£y l·∫ßu', 't·ª± t·ª≠', 't·ª± s√°t', 'kh√¥ng mu·ªën s·ªëng', 'nh·∫£y c·∫ßu', 'suicide', 'die', 'k·∫øt li·ªÖu','c·∫Øt tay','44'];
        const SWEAR_WORDS = ['dcm', 'ƒë·ªãt', 'c√∫t', 'cmm', 'm·∫π m√†y', 'm·ªçe', 'vcl', 'ƒëm', 'l·ªìn', 'cc', 'ƒë√©o'];
        
        let swearCount = 0;
        let isLocked = false;
        let lockTimer = null;
        let lastListId = ''; // Theo d√µi m√†n h√¨nh chat cu·ªëi c√πng d√πng

        const moodSongs = {
            healing: { title: "Spirited Away - Always with Me (Healing Piano)", link: "https://www.youtube.com/watch?v=H7P6m6_zX7o", icon: "üéπ" },
            sad: { title: "Nh·∫°c Lofi bu·ªìn xoa d·ªãu t√¢m h·ªìn", link: "https://www.youtube.com/watch?v=TURbeoOatvY", icon: "‚òÅÔ∏è" },
            energy: { title: "Nh·∫°c t√≠ch c·ª±c truy·ªÅn ƒë·ªông l·ª±c", link: "https://www.youtube.com/watch?v=E_S_m7eP8-0", icon: "‚ú®" },
            sleep: { title: "Nh·∫°c Piano ng·ªß ngon s√¢u gi·∫•c", link: "https://www.youtube.com/watch?v=q76bE7u6HAs", icon: "üåô" },
            study: { title: "Nh·∫°c Lofi t·∫≠p trung h·ªçc t·∫≠p", link: "https://www.youtube.com/watch?v=jfKfPfyJRdk", icon: "üìö" }
        };

        function updateAllInputs(locked, message = "Nh·∫≠p tin nh·∫Øn...") {
            const inputs = document.querySelectorAll('.chat-input-global');
            const btns = document.querySelectorAll('.chat-btn-global');
            inputs.forEach(input => {
                input.disabled = locked;
                input.placeholder = locked ? message : "Nh·∫≠p tin nh·∫Øn...";
                input.style.opacity = locked ? "0.5" : "1";
            });
            btns.forEach(btn => {
                btn.disabled = locked;
                btn.style.opacity = locked ? "0.5" : "1";
            });
        }

        function lockGlobalChat(seconds) {
            isLocked = true;
            let timeLeft = seconds;
            if(lockTimer) clearInterval(lockTimer);
            updateAllInputs(true, `B·ªã kh√≥a trong ${timeLeft}s...`);
            lockTimer = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                    clearInterval(lockTimer);
                    isLocked = false;
                    updateAllInputs(false);
                } else {
                    updateAllInputs(true, `B·ªã kh√≥a trong ${timeLeft}s...`);
                }
            }, 1000);
        }

        function checkSafety(text, listId) {
            const lowText = text.toLowerCase();
            lastListId = listId;
            if (DANGER_WORDS.some(word => lowText.includes(word))) {
                document.getElementById('emergency-overlay').classList.remove('hidden');
                return 'danger';
            }
            if (SWEAR_WORDS.some(word => lowText.includes(word))) {
                swearCount++;
                if (swearCount <= 2) return "C·∫≠u ∆°i, ƒë·ª´ng d√πng nh·ªØng t·ª´ ng·ªØ nh∆∞ v·∫≠y nh√©. H√£y t√¥n tr·ªçng nhau n√®! üòä";
                if (swearCount === 3) return "C·∫¢NH B√ÅO: N·∫øu c·∫≠u ti·∫øp t·ª•c d√πng t·ª´ ng·ªØ kh√¥ng ph√π h·ª£p, m√¨nh s·∫Ω kh√≥a chat c·ªßa c·∫≠u!";
                if (swearCount === 4) { lockGlobalChat(60); return "B·∫†N ƒê√É B·ªä KH√ìA CHAT 1 PH√öT."; }
                if (swearCount >= 5) { lockGlobalChat(600); return "B·∫†N ƒê√É B·ªä KH√ìA CHAT 10 PH√öT."; }
            }
            return 'safe';
        }

        function dismissEmergency() {
            document.getElementById('emergency-overlay').classList.add('hidden');
            setTimeout(() => {
                appendMsg(lastListId, "M·ª´ng l√† c·∫≠u ƒë√£ ·ªïn. T·ªõ ·ªü ƒë√¢y m√†. Nghe b·∫£n nh·∫°c Piano n√†y ƒë·ªÉ th·∫•y nh·∫π l√≤ng h∆°n nh√©:", 'bot');
                appendMusicCard(lastListId, moodSongs.healing);
            }, 600);
        }

        function appendMusicCard(listId, song) {
            const list = document.getElementById(listId);
            const div = document.createElement('div');
            div.className = "flex items-end gap-2 mb-4";
            div.innerHTML = `
                <div class="bubble-bot px-4 py-3 max-w-[85%] text-sm shadow-sm border border-white">
                    <div class="music-card">
                        <span class="text-xl">${song.icon}</span>
                        <div class="overflow-hidden">
                            <p class="font-bold text-[11px] truncate">${song.title}</p>
                            <a href="${song.link}" target="_blank" class="text-indigo-600 underline text-[10px] font-bold">Nghe tr√™n YouTube</a>
                        </div>
                    </div>
                </div>`;
            list.appendChild(div);
            list.parentElement.scrollTo({ top: list.parentElement.scrollHeight, behavior: 'smooth' });
        }

        function handleMoodMusic(text, listId) {
            const t = text.toLowerCase();
            if (t.includes('bu·ªìn ng·ªß') || t.includes('kh√≥ ng·ªß') || t.includes('m·∫•t ng·ªß')) return { msg: "Ng·ªß s·ªõm ƒë·ªÉ b·∫£o v·ªá s·ª©c kh·ªèe c·∫≠u nh√©. T·∫∑ng c·∫≠u b·∫£n nh·∫°c d·ªÖ ng·ªß n√®: üåô", song: moodSongs.sleep };
            if (t.includes('bu·ªìn') || t.includes('kh√≥c')) return { msg: "T·ªõ hi·ªÉu c·∫£m gi√°c c·ªßa c·∫≠u. Nghe ch√∫t nh·∫°c ƒë·ªÉ th·∫•y l√≤ng nh·∫π t√™nh nh√©: ‚òÅÔ∏è", song: moodSongs.sad };
            if (t.includes('m·ªát') || t.includes('ch√°n') || t.includes('ph·∫•n ch·∫•n')) return { msg: "V·ª±c d·∫≠y tinh th·∫ßn th√¥i n√†o! B·∫£n nh·∫°c n√†y s·∫Ω gi√∫p c·∫≠u vui v·∫ª h∆°n: ‚ú®", song: moodSongs.energy };
            if (t.includes('ch√°n h·ªçc') || t.includes('√°p l·ª±c') || t.includes('kh√¥ng mu·ªën h·ªçc')) return { msg: "T·ªõ bi·∫øt h·ªçc t·∫≠p r·∫•t v·∫•t v·∫£, nghe ch√∫t nh·∫°c t·∫≠p trung ƒë·ªÉ l·∫•y l·∫°i ƒë·ªông l·ª±c nh√©: üìö", song: moodSongs.study };
            return null;
        }

        // 2. D·ªÆ LI·ªÜU TH∆Ø VI·ªÜN (50 CH·ª¶ ƒê·ªÄ)
        const libraryData = [
            { id: 1, tag: 'D·∫≠y th√¨', title: "Tu·ªïi d·∫≠y th√¨ l√† g√¨? Nh·ªØng thay ƒë·ªïi c·ªßa c∆° th·ªÉ", img: "https://images.unsplash.com/photo-1596755389378-c31d21fd1273?w=500", content: "D·∫≠y th√¨ l√† giai ƒëo·∫°n ph√°t tri·ªÉn t·ª´ tr·∫ª con sang ng∆∞·ªùi l·ªõn. B·∫°n s·∫Ω cao l√™n nhanh, nam v·ª° gi·ªçng, n·ªØ b·∫Øt ƒë·∫ßu c√≥ kinh nguy·ªát. H√£y t·ª± tin nh√©!", link: "https://suckhoedoisong.vn/kien-thuc-ve-tuoi-day-thi-ma-tre-can-biet-169230522101344473.htm" },
            { id: 2, tag: 'S·ª©c kh·ªèe', title: "S·ª©c kh·ªèe sinh s·∫£n c∆° b·∫£n", img: "https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?w=500", content: "Hi·ªÉu bi·∫øt v·ªÅ c∆° th·ªÉ gi√∫p b·∫°n t·ª± b·∫£o v·ªá v√† chƒÉm s√≥c b·∫£n th√¢n ƒë√∫ng c√°ch h∆°n.", link: "https://moh.gov.vn/chuong-trinh-muc-tieu-quoc-gia/-/asset_publisher/7NG969m9N9N/content/cham-soc-suc-khoe-sinh-san-vi-thanh-nien-thanh-nien" },
            { id: 3, tag: 'C·∫£m x√∫c', title: "C·∫£m x√∫c tu·ªïi teen v√† c√°ch ki·ªÉm so√°t", img: "https://images.unsplash.com/photo-1516575334481-f85287c2c82d?w=500", content: "C·∫£m x√∫c tu·ªïi teen th∆∞·ªùng thay ƒë·ªïi nhanh. H√£y t·∫≠p h√≠t th·ªü s√¢u v√† chia s·∫ª v·ªõi ng∆∞·ªùi th√¢n nh√©.", link: "https://unicef.org/vietnam/vi/nh·ªØng-c√¢u-chuy·ªán/s√°u-chi·∫øn-l∆∞·ª£c-gi√∫p-thanh-thi·∫øu-ni√™n-chƒÉm-s√≥c-s·ª©c-kh·ªèe-t√¢m-th·∫ßn" },
            { id: 4, tag: 'T√¨nh b·∫°n', title: "T√¨nh b·∫°n ‚Äì l√†m sao ƒë·ªÉ c√≥ b·∫°n t·ªët", img: "https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=500", content: "B·∫°n t·ªët l√† ng∆∞·ªùi lu√¥n b√™n c·∫°nh v√† th·∫•u hi·ªÉu m√¨nh. H√£y tr√¢n tr·ªçng nh·ªØng ng∆∞·ªùi b·∫°n th·∫≠t l√≤ng.", link: "https://vov.vn/doi-song/the-nao-la-mot-tinh-ban-dep-va-ben-vung-873532.vov" },
            { id: 5, tag: 'H·ªçc t·∫≠p', title: "√Åp l·ª±c h·ªçc t·∫≠p v√† c√°ch v∆∞·ª£t qua", img: "https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=500", content: "H·ªçc t·∫≠p ƒë√¥i khi g√¢y m·ªát m·ªèi, h√£y ngh·ªâ ng∆°i h·ª£p l√Ω v√† ƒë·ª´ng so s√°nh m√¨nh v·ªõi ng∆∞·ªùi kh√°c.", link: "https://vinmec.com/vi/tin-tuc/suc-khoe-tong-quat/stress-hoc-tap-o-hoc-sinh-nguyen-nhan-va-cach-khac-phuc/" },
            { id: 6, tag: 'T·ª± tin', title: "T·ª± tin v√†o b·∫£n th√¢n", img: "https://images.unsplash.com/photo-1494438639946-1ebd1d20bf85?w=500", content: "T·ª± tin l√† ch√¨a kh√≥a c·ªßa th√†nh c√¥ng. H√£y y√™u th∆∞∆°ng ch√≠nh m√¨nh d√π b·∫°n c√≥ ƒëi·ªÉm y·∫øu g√¨.", link: "https://hust.edu.vn/vi/news/v∆∞·ª£t-qua-tu·ªïi-day-thi-tu-ti-de-tu-tin-hon-651543.html" },
            { id: 7, tag: 'Gi√° tr·ªã', title: "Gi√° tr·ªã b·∫£n th√¢n v√† l√≤ng t·ª± tr·ªçng", img: "https://psycare.com.vn/wp-content/uploads/2022/11/long-tu-ton-la-gi.jpg", content: "ƒê·ª´ng ƒë·ªÉ ai h·∫° th·∫•p gi√° tr·ªã c·ªßa c·∫≠u. C·∫≠u l√† phi√™n b·∫£n duy nh·∫•t v√† ƒë√°ng tr√¢n tr·ªçng.", link: "https://vnu.edu.vn/ttsk/?ID=2345" },
            { id: 8, tag: 'Giao ti·∫øp', title: "K·ªπ nƒÉng giao ti·∫øp hi·ªáu qu·∫£", img: "https://cdn-media.sforum.vn/storage/app/media/giakhanh/k%E1%BB%B9%20n%C4%83ng%20giao%20ti%E1%BA%BFp/ky-nang-giao-tiep-thumbnail.jpg", content: "N√≥i r√µ r√†ng v√† l·∫Øng nghe ch√¢n th√†nh s·∫Ω gi√∫p m·ªçi cu·ªôc tr√≤ chuy·ªán tr·ªü n√™n t·ªët ƒë·∫πp h∆°n.", link: "https://careerbuilder.vn/vi/talentnetwork/ky-nang-giao-tiep-cho-sinh-vien.35A510A7.html" },
            { id: 9, tag: 'K·ªπ nƒÉng', title: "K·ªπ nƒÉng l·∫Øng nghe", img: "https://images.unsplash.com/photo-1543269664-76bc3997d9ea?w=500", content: "L·∫Øng nghe kh√¥ng ch·ªâ b·∫±ng tai m√† b·∫±ng c·∫£ tr√°i tim ƒë·ªÉ th·∫•u hi·ªÉu s√¢u s·∫Øc ng∆∞·ªùi ƒë·ªëi di·ªán.", link: "https://tuoitre.vn/nghe-thuat-lang-nghe-de-thanh-cong-20191212111520123.htm" },
            { id: 10, tag: 'M√¢u thu·∫´n', title: "Gi·∫£i quy·∫øt m√¢u thu·∫´n kh√¥ng b·∫°o l·ª±c", img: "https://images.unsplash.com/photo-1573497019940-1c28c88b4f3e?w=500", content: "B√¨nh tƒ©nh ƒë·ªëi tho·∫°i thay v√¨ n·∫Øm ƒë·∫•m. S·ª± √¥n h√≤a lu√¥n gi·∫£i quy·∫øt ƒë∆∞·ª£c m·ªçi vi·ªác.", link: "https://gdnn.edu.vn/ky-nang-giai-quyet-xung-dot-khong-dung-bao-luc-654.html" },
            { id: 11, tag: 'An to√†n', title: "B·∫Øt n·∫°t h·ªçc ƒë∆∞·ªùng v√† c√°ch t·ª± b·∫£o v·ªá", img: "https://images.unsplash.com/photo-1544197150-b99a580bb7a8?w=500", content: "H√£y n√≥i ra khi b·ªã b·∫Øt n·∫°t. T·ªõ v√† ng∆∞·ªùi l·ªõn lu√¥n ƒë·ª©ng v·ªÅ ph√≠a c·∫≠u.", link: "https://baochinhphu.vn/phong-chong-bao-luc-hoc-duong-quyen-tre-em-102220412154433.htm" },
            { id: 12, tag: 'M·∫°ng XH', title: "An to√†n tr√™n m·∫°ng x√£ h·ªôi", img: "https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=500", content: "ƒê·ª´ng chia s·∫ª th√¥ng tin c√° nh√¢n b·ª´a b√£i. C·∫£nh gi√°c tr∆∞·ªõc nh·ªØng l·ªùi m·ªùi t·ª´ ng∆∞·ªùi l·∫°.", link: "https://unicef.org/vietnam/vi/an-to√†n-tr√™n-m·∫°ng" },
            { id: 13, tag: 'Internet', title: "S·ª≠ d·ª•ng Internet v√† game l√†nh m·∫°nh", img: "https://images.unsplash.com/photo-1542751371-adc38448a05e?w=500", content: "Game l√† gi·∫£i tr√≠, ƒë·ª´ng ƒë·ªÉ n√≥ ·∫£nh h∆∞·ªüng ƒë·∫øn ƒë·ªùi s·ªëng th·ª±c v√† vi·ªác h·ªçc nh√©.", link: "https://mic.gov.vn/bao-ve-tre-em-tren-khong-gian-mang.html" },
            { id: 14, tag: 'Th·ªùi gian', title: "Qu·∫£n l√Ω th·ªùi gian h·ªçc t·∫≠p v√† gi·∫£i tr√≠", img: "https://images.unsplash.com/photo-1501139083538-0139583c060f?w=500", content: "L·∫≠p th·ªùi gian bi·ªÉu m·ªói ng√†y ƒë·ªÉ c√¢n b·∫±ng gi·ªØa h·ªçc v√† ch∆°i c·∫≠u nh√©.", link: "https://news.timviec.com.vn/phuong-phap-quan-ly-thoi-gian-eisenhower-6543.html" },
            { id: 15, tag: 'H·ªçc t·∫≠p', title: "Th√≥i quen h·ªçc t·∫≠p hi·ªáu qu·∫£", img: "https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?w=500", content: "H·ªçc hi·ªÉu thay v√¨ h·ªçc v·∫πt. T√¨m m·ªôt kh√¥ng gian y√™n tƒ©nh ƒë·ªÉ t·ªëi ƒëa s·ª± t·∫≠p trung.", link: "https://edu.vn/phuong-phap-hoc-tap-cornell" },
            { id: 16, tag: 'ƒê·ªçc s√°ch', title: "ƒê·ªçc s√°ch v√† t∆∞ duy ph·∫£n bi·ªán", img: "https://images.unsplash.com/photo-1495446815901-a7297e633e8d?w=500", content: "S√°ch m·ªü ra ch√¢n tr·ªùi m·ªõi. ƒê·ª´ng ch·ªâ ƒë·ªçc, h√£y ƒë·∫∑t c√¢u h·ªèi ƒë·ªÉ ph√°t tri·ªÉn t∆∞ duy.", link: "https://vnexpress.net/tu-duy-phan-bien-la-gi-453213.html" },
            { id: 17, tag: 'M·ª•c ti√™u', title: "∆Ø·ªõc m∆°, m·ª•c ti√™u v√† t∆∞∆°ng lai", img: "https://images.unsplash.com/photo-1491438590914-bc09fcaaf77a?w=500", content: "∆Ø·ªõc m∆° gi√∫p cu·ªôc s·ªëng √Ω nghƒ©a. ƒê·∫∑t m·ª•c ti√™u nh·ªè m·ªói ng√†y ƒë·ªÉ ti·∫øn t·ªõi t∆∞∆°ng lai.", link: "https://topcv.vn/cach-xac-dinh-muc-tieu-nghe-nghiep" },
            { id: 18, tag: 'Kh√°m ph√°', title: "Kh√°m ph√° b·∫£n th√¢n: m√¨nh gi·ªèi ƒëi·ªÅu g√¨?", img: "https://images.unsplash.com/photo-1507413245164-6160d8298b31?w=500", content: "Th·ª≠ s·ª©c v·ªõi nhi·ªÅu lƒ©nh v·ª±c ƒë·ªÉ t√¨m ra ƒëam m√™ th·∫≠t s·ª± c·ªßa c·∫≠u nh√©.", link: "https://huongnghiep.edu.vn/trac-nghiem-tinh-cach-mbti" },
            { id: 19, tag: 'EQ', title: "Tr√≠ tu·ªá c·∫£m x√∫c (EQ)", img: "https://images.unsplash.com/photo-1493612276216-ee3925520721?w=500", content: "EQ cao gi√∫p c·∫≠u th·∫•u c·∫£m v√† x√¢y d·ª±ng c√°c m·ªëi quan h·ªá b·ªÅn v·ªØng.", link: "https://vietnamnet.vn/eq-la-gi-tam-quan-trong-cua-tri-tue-cam-xuc-6541.html" },
            { id: 20, tag: 'T√¨nh c·∫£m', title: "T√¨nh c·∫£m tu·ªïi h·ªçc tr√≤", img: "https://images.unsplash.com/photo-1474552226712-ac0f0961a954?w=500", content: "T√¨nh y√™u ƒë·∫ßu ƒë·ªùi ng√¢y ng√¥ v√† ƒë·∫πp ƒë·∫Ω. H√£y c√πng nhau ti·∫øn b·ªô trong h·ªçc t·∫≠p.", link: "https://tuoitre.vn/tinh-yeu-tuoi-hoc-tro-trong-sang-hay-nguy-hiem-20220512.htm" },
            { id: 21, tag: 'T√¥n tr·ªçng', title: "T√¥n tr·ªçng s·ª± kh√°c bi·ªát", img: "https://images.unsplash.com/photo-1521737711867-e3b97375f902?w=500", content: "M·ªói ng∆∞·ªùi l√† m·ªôt c√° t√≠nh ri√™ng. T√¥n tr·ªçng ng∆∞·ªùi kh√°c l√† t√¥n tr·ªçng ch√≠nh m√¨nh.", link: "https://unicef.org/vietnam/vi/cham-soc-suc-khoe-tam-than" },
            { id: 22, tag: 'Gi·ªõi t√≠nh', title: "B√¨nh ƒë·∫≥ng gi·ªõi", img: "https://images.unsplash.com/photo-1573164713988-8665fc963095?w=500", content: "Nam n·ªØ ƒë·ªÅu c√≥ quy·ªÅn l·ª£i v√† nghƒ©a v·ª• nh∆∞ nhau trong cu·ªôc s·ªëng hi·ªán ƒë·∫°i.", link: "https://be-gi-binh-dang-gioi.vn" },
            { id: 23, tag: 'C∆° th·ªÉ', title: "C∆° th·ªÉ m√¨nh ‚Äì quy·ªÅn ƒë∆∞·ª£c t√¥n tr·ªçng", img: "https://static.benhvienphusanhanoi.vn/w640/images/upload/08152023/xamhaitinhduc11636942427132591399153.jpg", content: "C·∫≠u c√≥ to√†n quy·ªÅn b·∫£o v·ªá c∆° th·ªÉ tr∆∞·ªõc b·∫•t k·ª≥ s·ª± x√¢m ph·∫°m kh√¥ng mong mu·ªën n√†o.", link: "https://unicef.org/vietnam/vi/phong-chong-xam-hai-tre-em" },
            { id: 24, tag: 'K·ªπ nƒÉng', title: "N√≥i ‚Äúkh√¥ng‚Äù khi c·∫ßn thi·∫øt", img: "https://images.unsplash.com/photo-1582213782179-e0d53f98f2ca?w=500", content: "Bi·∫øt t·ª´ ch·ªëi nh·ªØng ƒëi·ªÅu x·∫•u l√† bi·ªÉu hi·ªán c·ªßa s·ª± tr∆∞·ªüng th√†nh v√† b·∫£n lƒ©nh.", link: "https://suckhoedoisong.vn/nghe-thuat-noi-khong-cho-tre-em-1692212011.htm" },
            { id: 25, tag: 'Quy·∫øt ƒë·ªãnh', title: "Ra quy·∫øt ƒë·ªãnh ƒë√∫ng ƒë·∫Øn", img: "https://gitiho.com/caches/p_medium_large//uploads/281464/images/img_ky-nang-ra-quyet-dinh-1.jpg", content: "D·ª´ng l·∫°i 3 gi√¢y ƒë·ªÉ suy nghƒ© h·∫≠u qu·∫£ tr∆∞·ªõc khi th·ª±c hi·ªán b·∫•t k·ª≥ h√†nh ƒë·ªông n√†o.", link: "https://vnexpress.net/6-buoc-giup-vi-thanh-nien-ra-quyet-dinh-45678.html" },
            { id: 26, tag: 'Th·∫•t b·∫°i', title: "·ª®ng ph√≥ v·ªõi th·∫•t b·∫°i", img: "https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?w=500", content: "Th·∫•t b·∫°i ch·ªâ l√† b√†i h·ªçc ƒë·ªÉ th√†nh c√¥ng. ƒê·ª´ng n·∫£n l√≤ng khi g·∫∑p v·∫•p ng√£.", link: "https://tuoitre.vn/cach-giup-tre-doi-mat-voi-that-bai-20221012.htm" },
            { id: 27, tag: 'Th√°i ƒë·ªô', title: "L√≤ng bi·∫øt ∆°n v√† s·ªëng t√≠ch c·ª±c", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSkJcvwVeHSji_MKTAeF9NgwoFYV_jn1X92RQ&s", content: "L√≤ng bi·∫øt ∆°n gi√∫p c·∫≠u c·∫£m th·∫•y h·∫°nh ph√∫c v√† l·∫°c quan h∆°n v·ªõi ƒë·ªùi.", link: "https://thanhnien.vn/suc-manh-cua-long-biet-on-18512345.htm" },
            { id: 28, tag: 'Nh√≥m', title: "K·ªπ nƒÉng l√†m vi·ªác nh√≥m", img: "https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=500", content: "H·ªçc c√°ch h·ª£p t√°c v√† chia s·∫ª c√¥ng vi·ªác ƒë·ªÉ c√πng nhau ƒë·∫°t m·ª•c ti√™u chung.", link: "https://careerbuilder.vn/vi/talentnetwork/ky-nang-lam-viec-nhom.35A510A7.html" },
            { id: 29, tag: 'L√£nh ƒë·∫°o', title: "L√£nh ƒë·∫°o b·∫£n th√¢n", img: "https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=500", content: "L√†m ch·ªß suy nghƒ© v√† h√†nh ƒë·ªông c·ªßa m√¨nh l√† b∆∞·ªõc ƒë·∫ßu ƒë·ªÉ l√£nh ƒë·∫°o cu·ªôc ƒë·ªùi.", link: "https://hbr.org.vn/lanh-dao-ban-than-la-gi" },
            { id: 30, tag: 'T√¢m l√Ω', title: "S·ª©c kh·ªèe tinh th·∫ßn", img: "https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=500", content: "ChƒÉm s√≥c t√¢m h·ªìn m·ªói ng√†y b·∫±ng s·ª± th∆∞ gi√£n v√† nh·ªØng suy nghƒ© l√†nh m·∫°nh.", link: "https://vinmec.com/vi/tin-tuc/suc-khoe-tong-quat/suc-khoe-tam-than-vi-thanh-nien/" },
            { id: 31, tag: 'Bu·ªìn b√£', title: "T√¨m s·ª± gi√∫p ƒë·ª° khi bu·ªìn, stress", img: "https://images.unsplash.com/photo-1516589091380-5d8e87df6999?w=500", content: "ƒê·ª´ng ch·ªãu ƒë·ª±ng m·ªôt m√¨nh. Lu√¥n c√≥ t·ªõ v√† ng∆∞·ªùi th√¢n s·∫µn s√†ng l·∫Øng nghe.", link: "https://unicef.org/vietnam/vi/cham-soc-suc-khoe-tam-than" },
            { id: 32, tag: 'Th·ªÉ thao', title: "Th·ªÉ thao v√† v·∫≠n ƒë·ªông cho tu·ªïi teen", img: "https://www.vinmec.com/static/uploads/large_20210125_132925_245449_tap_the_duc_max_1800x1800_jpg_082df832c6.jpg", content: "Th·ªÉ d·ª•c gi√∫p c∆° th·ªÉ d·∫ªo dai v√† tinh th·∫ßn ph·∫•n ch·∫•n h∆°n bao gi·ªù h·∫øt.", link: "https://vov.vn/suc-khoe/loi-ich-cua-viec-tap-the-duc-voi-tre-em-876543.vov" },
            { id: 33, tag: 'Dinh d∆∞·ª°ng', title: "Dinh d∆∞·ª°ng v√† chƒÉm s√≥c s·ª©c kh·ªèe", img: "https://images.unsplash.com/photo-1490818387583-1baba5e638af?w=500", content: "ƒÇn u·ªëng ƒë·ªß ch·∫•t gi√∫p c·∫≠u c√≥ nƒÉng l∆∞·ª£ng h·ªçc t·∫≠p v√† ph√°t tri·ªÉn th·ªÉ ch·∫•t.", link: "https://vinmec.com/vi/tin-tuc/dinh-duong/che-do-dinh-duong-cho-tuoi-day-thi/" },
            { id: 34, tag: 'Gi·∫•c ng·ªß', title: "Th√≥i quen ng·ªß l√†nh m·∫°nh", img: "https://images2.thanhnien.vn/528068263637045248/2023/3/3/thoi-quen-ngu-16778382142822006400460.jpg", content: "Ng·ªß ƒë·ªß gi·∫•c gi√∫p n√£o b·ªô h·ªìi ph·ª•c v√† ph√°t tri·ªÉn chi·ªÅu cao hi·ªáu qu·∫£.", link: "https://vinmec.com/vi/tin-tuc/giac-ngu-vi-thanh-nien-quan-trong-nhu-the-nao/" },
            { id: 35, tag: 'T·ª± l·∫≠p', title: "K·ªπ nƒÉng t·ª± l·∫≠p c∆° b·∫£n", img: "https://images.unsplash.com/photo-1556910103-1c02745aae4d?w=500", content: "T·ª± chƒÉm s√≥c b·∫£n th√¢n gi√∫p c·∫≠u t·ª± tin h∆°n khi b∆∞·ªõc v√†o cu·ªôc s·ªëng.", link: "https://tuoitre.vn/day-con-ky-nang-tu-lap-20210612.htm" },
            { id: 36, tag: 'Tr√°ch nhi·ªám', title: "Tr√°ch nhi·ªám v·ªõi b·∫£n th√¢n v√† gia ƒë√¨nh", img: "https://infina.vn/blog/wp-content/uploads/2022/06/trach-nhiem.jpg", content: "L√†m t·ªët vi·ªác c·ªßa m√¨nh l√† c√°ch t·ªët nh·∫•t ƒë·ªÉ th·ªÉ hi·ªán tr√°ch nhi·ªám.", link: "https://unicef.org/vietnam/vi/nuoi-day-con-ky-nguyen-so" },
            { id: 37, tag: 'Gia ƒë√¨nh', title: "Gi√° tr·ªã gia ƒë√¨nh", img: "https://images.unsplash.com/photo-1511895426328-dc8714191300?w=500", content: "Gia ƒë√¨nh l√† n∆°i y√™u th∆∞∆°ng v√¥ ƒëi·ªÅu ki·ªán, h√£y tr√¢n tr·ªçng t·ª´ng kho·∫£nh kh·∫Øc.", link: "https://baochinhphu.vn/gia-tri-gia-dinh-viet-nam-truyen-thong-102210615154433.htm" },
            { id: 38, tag: 'ƒê·ªìng c·∫£m', title: "T√¨nh y√™u th∆∞∆°ng v√† s·ª± ƒë·ªìng c·∫£m", img: "https://images.unsplash.com/photo-1469571486292-0ba58a3f068b?w=500", content: "ƒê·ªìng c·∫£m gi√∫p k·∫øt n·ªëi nh·ªØng tr√°i tim v√† l√†m th·∫ø gi·ªõi t·ªët ƒë·∫πp h∆°n.", link: "https://vov.vn/doi-song/gia-tri-cua-su-dong-cam-trong-cuoc-song-876543.vov" },
            { id: 39, tag: '√ù ki·∫øn', title: "K·ªπ nƒÉng tr√¨nh b√†y √Ω ki·∫øn", img: "https://unica.vn/media/imagesck/1630990739_thuyet-trinh-la-gi.jpg?v=1630990739", content: "H√£y t·ª± tin n√≥i l√™n suy nghƒ© c·ªßa m√¨nh m·ªôt c√°ch l·ªÖ ph√©p v√† r√µ r√†ng.", link: "https://careerbuilder.vn/vi/talentnetwork/ky-nang-trinh-bay.35A510A7.html" },
            { id: 40, tag: 'S√°ng t·∫°o', title: "S√°ng t·∫°o v√† ngh·ªá thu·∫≠t", img: "https://www.cet.edu.vn/wp-content/uploads/2019/03/sang-tao-la-kha-nang-tu-duy.jpg", content: "S√°ng t·∫°o kh√¥ng gi·ªõi h·∫°n gi√∫p cu·ªôc s·ªëng th√™m nhi·ªÅu m√†u s·∫Øc th√∫ v·ªã.", link: "https://vnexpress.net/nghe-thuat-giup-giam-stress-45678.html" },
            { id: 41, tag: 'ƒê·ªçc s√°ch', title: "ƒê·ªçc s√°ch ƒë·ªÉ tr∆∞·ªüng th√†nh", img: "https://images.unsplash.com/photo-1495446815901-a7297e633e8d?w=500", content: "M·ªói trang s√°ch l√† m·ªôt b·∫≠c thang d·∫´n c·∫≠u ƒë·∫øn tri th·ª©c m·ªõi.", link: "https://nxbtre.com.vn/sach-cho-tuoi-moi-lon" },
            { id: 42, tag: 'C·∫£m h·ª©ng', title: "Nh·ªØng t·∫•m g∆∞∆°ng truy·ªÅn c·∫£m h·ª©ng", img: "https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=500", content: "Nh√¨n v√†o nh·ªØng ng∆∞·ªùi th√†nh c√¥ng ƒë·ªÉ l·∫•y ƒë·ªông l·ª±c n·ªó l·ª±c h∆°n m·ªói ng√†y.", link: "https://vietnamnet.vn/nhung-tam-guong-vuot-kho-hoc-gioi-65432.html" },
            { id: 43, tag: 'Khoa h·ªçc', title: "Khoa h·ªçc th√∫ v·ªã quanh ta", img: "https://vinuni.edu.vn/wp-content/uploads/2024/08/tam-quan-trong-cua-tam-ly-hoc-dai-cuong-trong-nghien-cuu-va-ung-dung-hinh-1.jpg", content: "Khoa h·ªçc th√∫ v·ªã quanh ta gi√∫p tu·ªïi d·∫≠y th√¨ hi·ªÉu c∆° th·ªÉ, c·∫£m x√∫c v√† th√≥i quen h·∫±ng ng√†y, t·ª´ ƒë√≥ b·ªõt lo l·∫Øng, bi·∫øt chƒÉm s√≥c b·∫£n th√¢n v√† t·ª± tin h∆°n.", link: "https://khoahoc.tv" },
            { id: 44, tag: 'T∆∞∆°ng lai', title: "C√¥ng ngh·ªá v√† t∆∞∆°ng lai", img: "https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=500", content: "C√¥ng ngh·ªá ƒëang thay ƒë·ªïi th·∫ø gi·ªõi h·∫±ng ng√†y, h√£y l√†m ch·ªß n√≥.", link: "https://vnexpress.net/so-hoa" },
            { id: 45, tag: 'M√¥i tr∆∞·ªùng', title: "B·∫£o v·ªá m√¥i tr∆∞·ªùng", img: "https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?w=500", content: "Tr√°i ƒë·∫•t l√† nh√†, b·∫£o v·ªá m√¥i tr∆∞·ªùng l√† b·∫£o v·ªá ch√≠nh t∆∞∆°ng lai c·ªßa c·∫≠u.", link: "https://monre.gov.vn/Pages/bao-ve-moi-truong.aspx" },
            { id: 46, tag: 'C√¥ng d√¢n', title: "C√¥ng d√¢n s·ªë c√≥ tr√°ch nhi·ªám", img: "https://images.unsplash.com/photo-1516259762381-22954d7d3ad2?w=500", content: "H√†nh x·ª≠ vƒÉn minh v√† l·ªãch s·ª± tr√™n kh√¥ng gian m·∫°ng l√† ƒëi·ªÅu c·∫ßn thi·∫øt.", link: "https://unicef.org/vietnam/vi/an-toan-tren-mang" },
            { id: 47, tag: 'An to√†n', title: "K·ªπ nƒÉng an to√†n c√° nh√¢n", img: "https://baovelongviet.vn/wp-content/uploads/2023/02/ky-nang-tu-ve-la-gi.jpg", content: "Lu√¥n c·∫£nh gi√°c v√† trang b·ªã cho m√¨nh nh·ªØng k·ªπ nƒÉng t·ª± v·ªá c∆° b·∫£n.", link: "https://treemvietnam.vn/ky-nang-tu-ve" },
            { id: 48, tag: 'Ph√≤ng tr√°nh', title: "Ph√≤ng tr√°nh c√°c h√†nh vi nguy hi·ªÉm", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQcz7pEmYSgLItql1EhooXDbkAJ0J8RTJ-akQ&s", content: "N√≥i kh√¥ng v·ªõi ch·∫•t k√≠ch th√≠ch v√† thu·ªëc l√° ƒëi·ªán t·ª≠ ƒë·ªÉ b·∫£o v·ªá b·∫£n th√¢n.", link: "https://moh.gov.vn/tac-hai-cua-thuoc-la" },
            { id: 49, tag: 'H·ªçc ƒë∆∞·ªùng', title: "VƒÉn h√≥a h·ªçc ƒë∆∞·ªùng t√≠ch c·ª±c", img: "https://images.unsplash.com/photo-1509062522246-3755977927d7?w=500", content: "T·∫°o d·ª±ng m√¥i tr∆∞·ªùng h·ªçc t·∫≠p ƒëo√†n k·∫øt, th√¢n thi·ªán v√† gi√†u y√™u th∆∞∆°ng.", link: "https://moet.gov.vn/chinh-sach/van-ban-moi/Pages/xay-dung-van-hoa-hoc-duong.aspx" },
            { id: 50, tag: '∆Ø·ªõc m∆°', title: "Tr∆∞·ªüng th√†nh c√πng tr√°ch nhi·ªám v√† ∆∞·ªõc m∆°", img: "https://images.unsplash.com/photo-1491438590914-bc09fcaaf77a?w=500", content: "M·ªçi n·ªó l·ª±c h√¥m nay ƒë·ªÅu l√† n·ªÅn t·∫£ng cho th√†nh c√¥ng c·ªßa c·∫≠u mai sau.", link: "https://tuoitre.vn/song-co-trach-nhiem-tu-nhung-viec-nho-nhat.htm" }
        ];

        const grid = document.getElementById('article-grid');
        libraryData.forEach(item => {
            const art = document.createElement('article');
            art.className = 'article-item bg-white rounded-3xl overflow-hidden shadow-sm border border-slate-100 hover:shadow-md transition-all cursor-pointer group';
            art.setAttribute('data-search', item.title.toLowerCase());
            art.onclick = () => openArticle(item);
            art.innerHTML = `<div class="h-40 overflow-hidden relative"><img src="${item.img}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"><span class="absolute top-3 left-3 bg-white/90 px-2 py-1 rounded-lg text-[9px] font-bold text-indigo-600">${item.tag}</span></div><div class="p-4"><h3 class="font-bold text-slate-800 text-sm leading-tight">${item.title}</h3></div>`;
            grid.appendChild(art);
        });

        function openArticle(item) {
            document.getElementById('detail-img').src = item.img;
            document.getElementById('detail-tag').innerText = item.tag;
            document.getElementById('detail-title').innerText = item.title;
            document.getElementById('detail-header-title').innerText = item.title;
            document.getElementById('detail-content').innerText = item.content;
            document.getElementById('detail-link').href = item.link;
            document.getElementById('detail-link').innerText = item.link;
            const detailScreen = document.getElementById('article-detail');
            detailScreen.classList.remove('hidden-screen');
            gsap.fromTo(detailScreen, {y: '100%'}, {y: 0, duration: 0.4, ease: "power2.out"});
        }

        function closeArticle() {
            gsap.to('#article-detail', {y: '100%', duration: 0.4, onComplete: () => {
                document.getElementById('article-detail').classList.add('hidden-screen');
            }});
        }

        function getResponse(input, role) {
            const lowInput = input.toLowerCase();
            const music = handleMoodMusic(input, ''); // Check nh·∫°c tr∆∞·ªõc
            if(music) return { isMusic: true, data: music };

            const matchArticle = libraryData.find(art => lowInput.includes(art.tag.toLowerCase()) || lowInput.includes(art.title.toLowerCase().substring(0, 10)));
            if(matchArticle) return matchArticle.content;

            const botBrain = [
                { keywords: ['m·ª•n', 'da'], responses: { 
                    friend: "M·ª•n ch√°n x·ªâu! üò© ƒê·ª´ng n·∫∑n nha, s·∫πo ƒë√≥. R·ª≠a m·∫∑t k·ªπ v√†o nh√©!", 
                    parent: "Con ƒë·ª´ng lo qu√°, d·∫≠y th√¨ ai c≈©ng b·ªã m·ª•n m√†. ƒê·ªÉ m·∫π mua s·ªØa r·ª≠a m·∫∑t cho con nhen.", 
                    expert: "M·ª•n l√† do b√£ nh·ªùn tƒÉng ti·∫øt. Em n√™n l√†m s·∫°ch da 2 b∆∞·ªõc nh√©.",
                    companion: "M·ª•n l√† d·∫•u hi·ªáu c·∫≠u ƒëang l·ªõn ƒë√≥. R·ª≠a m·∫∑t 2 l·∫ßn/ng√†y nh√©! üåø"
                }},
                { keywords: ['cao', 'chi·ªÅu cao'], responses: { 
                    friend: "ƒêi b∆°i ƒë√™ bro! üèä‚Äç‚ôÇÔ∏è U·ªëng s·ªØa thay n∆∞·ªõc l·ªçc lu√¥n kkk.", 
                    parent: "Con ch·ªãu kh√≥ ƒÉn nhi·ªÅu canxi v√† ng·ªß tr∆∞·ªõc 10h t·ªëi ƒëi con.", 
                    expert: "Giai ƒëo·∫°n n√†y l√† ƒë·ªânh tƒÉng tr∆∞·ªüng. Em c·∫ßn k·∫øt h·ª£p Dinh d∆∞·ª°ng v√† v·∫≠n ƒë·ªông.",
                    companion: "ƒê·ªÉ cao th√™m, c·∫≠u h√£y ng·ªß s·ªõm tr∆∞·ªõc 10h ƒë√™m nh√©! üèÄ"
                }}
            ];

            const item = botBrain.find(b => b.keywords.some(k => lowInput.includes(k)));
            if(item) return item.responses[role];

            const defaultAnswers = {
                friend: "K·ªÉ k·ªπ h∆°n ƒëi bro, tui ƒëang nghe n√®! üòé",
                parent: "B·ªë m·∫π lu√¥n l·∫Øng nghe con ƒë√¢y, k·ªÉ ti·∫øp ƒëi con y√™u. üè°",
                expert: "T√¥i hi·ªÉu, em c√≥ th·ªÉ chia s·∫ª c·ª• th·ªÉ h∆°n ƒë∆∞·ª£c kh√¥ng? üë©‚Äç‚öïÔ∏è",
                companion: "T·ªõ ƒëang nghe c·∫≠u ƒë√¢y, chuy·ªán n√†y l√†m c·∫≠u nghƒ© ng·ª£i nhi·ªÅu kh√¥ng? ü§î"
            };
            return defaultAnswers[role];
        }

        function showScreen(screenId) {
            const screens = ['#landing-page', '#multi-dim-chat', '#companion-chat', '#library-page'];
            screens.forEach(s => {
                const el = document.querySelector(s);
                if(s === screenId) {
                    el.classList.remove('hidden-screen');
                    gsap.fromTo(s, {opacity: 0, y: 20}, {opacity: 1, y: 0, duration: 0.4});
                } else { el.classList.add('hidden-screen'); }
            });
            lucide.createIcons();
        }

        function triggerQuickExit() { window.location.replace("https://www.google.com"); }
        function autoExpand(t) { t.style.height = 'auto'; t.style.height = t.scrollHeight + 'px'; }

        let multiRole = 'friend';
        function selectRole(role) {
            multiRole = role;
            gsap.to('#role-selection-screen', {opacity: 0, duration: 0.3, onComplete: () => {
                document.getElementById('role-selection-screen').classList.add('hidden-screen');
                const ui = document.getElementById('multi-chat-ui');
                ui.classList.remove('hidden-screen');
                gsap.to(ui, {opacity: 1, duration: 0.3});
                document.getElementById('multi-bot-avatar').innerText = { friend: 'üòé', parent: 'üè°', expert: 'üë©‚Äç‚öïÔ∏è' }[role];
                const greet = role === 'parent' ? "Ch√†o con y√™u! H√¥m nay ƒëi h·ªçc c√≥ vui kh√¥ng? V·ªÅ nh√† c√≥ chuy·ªán g√¨ k·ªÉ b·ªë m·∫π nghe n√†o. üè°" : "Ch√†o c·∫≠u, t·ªõ ƒë√£ s·∫µn s√†ng l·∫Øng nghe!";
                appendMsg('multi-message-list', greet, 'bot');
            }});
        }

        function resetMultiChat() {
            document.getElementById('multi-chat-ui').classList.add('hidden-screen');
            document.getElementById('role-selection-screen').classList.remove('hidden-screen');
            document.getElementById('role-selection-screen').style.opacity = 1;
            document.getElementById('multi-message-list').innerHTML = '';
        }

        function sendMultiMessage() {
            const input = document.getElementById('multi-chat-input');
            const text = input.value.trim();
            if(!text || isLocked) return;
            appendMsg('multi-message-list', text, 'user');
            input.value = ''; input.style.height = 'auto';
            const safety = checkSafety(text, 'multi-message-list');
            if(safety === 'danger') return;
            document.getElementById('multi-typing').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('multi-typing').classList.add('hidden');
                const res = getResponse(text, multiRole);
                if(res.isMusic) { appendMsg('multi-message-list', res.data.msg, 'bot'); appendMusicCard('multi-message-list', res.data.song); }
                else { appendMsg('multi-message-list', safety !== 'safe' ? safety : res, 'bot'); }
            }, 1000);
        }

        function sendCompanionMessage() {
            const input = document.getElementById('companion-chat-input');
            const text = input.value.trim();
            if(!text || isLocked) return;
            appendMsg('companion-message-list', text, 'user');
            input.value = ''; input.style.height = 'auto';
            const safety = checkSafety(text, 'companion-message-list');
            if(safety === 'danger') return;
            document.getElementById('companion-typing').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('companion-typing').classList.add('hidden');
                const res = getResponse(text, 'companion');
                if(res.isMusic) { appendMsg('companion-message-list', res.data.msg, 'bot'); appendMusicCard('companion-message-list', res.data.song); }
                else { appendMsg('companion-message-list', safety !== 'safe' ? safety : res, 'bot'); }
            }, 1000);
        }

        function appendMsg(listId, text, sender) {
            const list = document.getElementById(listId);
            const div = document.createElement('div');
            div.className = sender === 'user' ? 'flex justify-end mb-4' : 'flex items-end gap-2 mb-4';
            div.innerHTML = `<div class="p-3 rounded-2xl text-sm ${sender === 'user' ? 'bubble-user' : 'bubble-bot'} shadow-sm max-w-[85%]">${text}</div>`;
            list.appendChild(div);
            list.parentElement.scrollTo({ top: list.parentElement.scrollHeight, behavior: 'smooth' });
        }

        const chips = ["D·∫≠y th√¨?", "Cao th√™m?", "√Åp l·ª±c?", "Crush?", "M·∫•t ng·ªß?"];
        const chipsContainer = document.getElementById('companion-quick-chips');
        chips.forEach(c => {
            const btn = document.createElement('button');
            btn.className = "whitespace-nowrap bg-white border border-slate-100 text-slate-600 text-[11px] font-bold px-4 py-2 rounded-full shadow-sm";
            btn.innerText = c; btn.onclick = () => { if(!isLocked) { document.getElementById('companion-chat-input').value = c; sendCompanionMessage(); } };
            chipsContainer.appendChild(btn);
        });

        function clearCompanionChat() { document.getElementById('companion-message-list').innerHTML = ''; }
        function searchArticles() { 
            const q = document.getElementById('lib-search').value.toLowerCase();
            document.querySelectorAll('.article-item').forEach(i => i.style.display = i.innerText.toLowerCase().includes(q) ? 'block' : 'none');
        }
    </script>
</body>
</html>